function dean_addEvent(e,t,o){if(e.addEventListener)e.addEventListener(t,o,!1);else{o.$$guid||(o.$$guid=dean_addEvent.guid++),e.events||(e.events={});var n=e.events[t];n||(n=e.events[t]={},e["on"+t]&&(n[0]=e["on"+t])),n[o.$$guid]=o,e["on"+t]=handleEvent}}function removeEvent(e,t,o){e.removeEventListener?e.removeEventListener(t,o,!1):e.events&&e.events[t]&&delete e.events[t][o.$$guid]}function handleEvent(e){var t=!0;e=e||fixEvent(((this.ownerDocument||this.document||this).parentWindow||window).event);var o=this.events[e.type];for(var n in o)this.$$handleEvent=o[n],!1===this.$$handleEvent(e)&&(t=!1);return t}function fixEvent(e){return e.preventDefault=fixEvent.preventDefault,e.stopPropagation=fixEvent.stopPropagation,e}var stIsIE=!1,isscr=!1;if(sorttable={init:function(){arguments.callee.done||(arguments.callee.done=!0,_timer&&clearInterval(_timer),document.createElement&&document.getElementsByTagName&&(sorttable.DATE_RE=/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)/,forEach(document.getElementsByTagName("table"),function(e){-1!=e.className.search(/\bsortable\b/)&&sorttable.makeSortable(e)})))},makeSortable:function(e,o){if(isscr=null!=o,0==e.getElementsByTagName("thead").length&&(the=document.createElement("thead"),the.appendChild(e.rows[0]),e.insertBefore(the,e.firstChild)),null==e.tHead&&(e.tHead=e.getElementsByTagName("thead")[0]),1==e.tHead.rows.length){sortbottomrows=[];for(var t=0;t<e.rows.length;t++)-1!=e.rows[t].className.search(/\bsortbottom\b/)&&(sortbottomrows[sortbottomrows.length]=e.rows[t]);if(sortbottomrows){for(null==e.tFoot&&(tfo=document.createElement("tfoot"),e.appendChild(tfo)),t=0;t<sortbottomrows.length;t++)tfo.appendChild(sortbottomrows[t]);delete sortbottomrows}for(headrow=e.tHead.rows[0].cells,t=0;t<headrow.length;t++)headrow[t].className.match(/\bsorttable_nosort\b/)||(mtch=headrow[t].className.match(/\bsorttable_([a-z0-9]+)\b/),mtch&&(override=mtch[1]),mtch&&"function"==typeof sorttable["sort_"+override]?headrow[t].sorttable_sortfunction=sorttable["sort_"+override]:headrow[t].sorttable_sortfunction=sorttable.guessType(e,t,o),headrow[t].sorttable_columnindex=t,headrow[t].sorttable_tbody=null!=o?o.tBodies[0]:e.tBodies[0],dean_addEvent(headrow[t],"click",sorttable.innerSortFunction=function(e){if(-1!=this.className.search(/\bsorttable_sorted\b/))return null!=o&&sorttable.reverse(this.sorttable_tbody),this.className=this.className.replace("sorttable_sorted","sorttable_sorted_reverse"),this.removeChild(document.getElementById("sorttable_sortfwdind")),sortrevind=document.createElement("span"),sortrevind.id="sorttable_sortrevind",sortrevind.innerHTML=stIsIE?'&nbsp<font face="webdings">5</font>':"&nbsp;&#x25B4;",void this.appendChild(sortrevind);if(-1!=this.className.search(/\bsorttable_sorted_reverse\b/))return null!=o&&sorttable.reverse(this.sorttable_tbody),this.className=this.className.replace("sorttable_sorted_reverse","sorttable_sorted"),this.removeChild(document.getElementById("sorttable_sortrevind")),sortfwdind=document.createElement("span"),sortfwdind.id="sorttable_sortfwdind",sortfwdind.innerHTML=stIsIE?'&nbsp<font face="webdings">6</font>':"&nbsp;&#x25BE;",void this.appendChild(sortfwdind);if(theadrow=this.parentNode,forEach(theadrow.childNodes,function(e){1==e.nodeType&&(e.className=e.className.replace("sorttable_sorted_reverse",""),e.className=e.className.replace("sorttable_sorted",""))}),sortfwdind=document.getElementById("sorttable_sortfwdind"),sortfwdind&&sortfwdind.parentNode.removeChild(sortfwdind),sortrevind=document.getElementById("sorttable_sortrevind"),sortrevind&&sortrevind.parentNode.removeChild(sortrevind),this.className+=" sorttable_sorted",sortfwdind=document.createElement("span"),sortfwdind.id="sorttable_sortfwdind",sortfwdind.innerHTML=stIsIE?'&nbsp<font face="webdings">6</font>':"&nbsp;&#x25BE;",this.appendChild(sortfwdind),0==isscr){row_array=[],col=this.sorttable_columnindex,rows=this.sorttable_tbody.rows;for(var t=0;t<rows.length;t++)row_array[row_array.length]=[sorttable.getInnerText(rows[t].cells[col]),rows[t]];for(row_array.sort(this.sorttable_sortfunction),tb=this.sorttable_tbody,t=0;t<row_array.length;t++)tb.appendChild(row_array[t][1]);delete row_array}}))}},guessType:function(e,t,o){var n=e.tBodies[0];if(o&&(n=o.tBodies[0]),null!=n&&0==n.rows.length)return sorttable.sort_alpha;if(sortfn=sorttable.sort_alpha,null!=n){if(text=sorttable.getInnerText(n.rows[0].cells[t]),""!=text){if(text.match(/^-?[£$¤]?[\d,.]+%?$/))return sorttable.sort_numeric;if(possdate=text.match(sorttable.DATE_RE),possdate){if(first=parseInt(possdate[1]),second=parseInt(possdate[2]),12<first)return sorttable.sort_ddmm;if(12<second)return sorttable.sort_mmdd;sortfn=sorttable.sort_ddmm}}return sortfn}return sorttable.sort_alpha},getInnerText:function(e){if(!e)return"";if(hasInputs="function"==typeof e.getElementsByTagName&&e.getElementsByTagName("input").length,void 0===e.getAttribute||"function"!=typeof e.getAttribute)return"";if("input"==e.nodeName.toLowerCase()&&"checkbox"==$("#"+e.id).attr("type"))return 1==$("#"+e.id).is(":checked")?"false":"true";if(null!=e.getAttribute("sorttable_customkey"))return e.getAttribute("sorttable_customkey");if(void 0!==e.textContent&&!hasInputs)return e.textContent.replace(/^\s+|\s+$/g,"");if(void 0!==e.innerText&&!hasInputs)return e.innerText.replace(/^\s+|\s+$/g,"");if(void 0!==e.text&&!hasInputs)return e.text.replace(/^\s+|\s+$/g,"");switch(e.nodeType){case 3:if("input"==e.nodeName.toLowerCase())return e.value.replace(/^\s+|\s+$/g,"");case 4:return e.nodeValue.replace(/^\s+|\s+$/g,"");case 1:case 11:for(var t="",o=0;o<e.childNodes.length;o++)t+=sorttable.getInnerText(e.childNodes[o]);return t.replace(/^\s+|\s+$/g,"");default:return""}},reverse:function(e){if(e){newrows=[];for(var t=0;t<e.rows.length;t++)newrows[newrows.length]=e.rows[t];for(t=newrows.length-1;0<=t;t--)e.appendChild(newrows[t]);delete newrows}},sort_numeric:function(e,t){return aa=parseFloat(e[0].replace(/[^0-9.-]/g,"")),isNaN(aa)&&(aa=0),bb=parseFloat(t[0].replace(/[^0-9.-]/g,"")),isNaN(bb)&&(bb=0),aa-bb},sort_alpha:function(e,t){return e[0]==t[0]?0:e[0]<t[0]?-1:1},sort_ddmm:function(e,t){return mtch=e[0].match(sorttable.DATE_RE),y=mtch[3],m=mtch[2],d=mtch[1],1==m.length&&(m="0"+m),1==d.length&&(d="0"+d),dt1=y+m+d,mtch=t[0].match(sorttable.DATE_RE),y=mtch[3],m=mtch[2],d=mtch[1],1==m.length&&(m="0"+m),1==d.length&&(d="0"+d),dt2=y+m+d,dt1==dt2?0:dt1<dt2?-1:1},sort_mmdd:function(e,t){return mtch=e[0].match(sorttable.DATE_RE),y=mtch[3],d=mtch[2],m=mtch[1],1==m.length&&(m="0"+m),1==d.length&&(d="0"+d),dt1=y+m+d,mtch=t[0].match(sorttable.DATE_RE),y=mtch[3],d=mtch[2],m=mtch[1],1==m.length&&(m="0"+m),1==d.length&&(d="0"+d),dt2=y+m+d,dt1==dt2?0:dt1<dt2?-1:1},shaker_sort:function(e,t){for(var o=0,n=e.length-1,r=!0;r;){r=!1;for(var s=o;s<n;++s)if(0<t(e[s],e[s+1])){var a=e[s];e[s]=e[s+1],e[s+1]=a,r=!0}if(n--,!r)break;for(s=n;o<s;--s)t(e[s],e[s-1])<0&&(a=e[s],e[s]=e[s-1],e[s-1]=a,r=!0);o++}}},document.addEventListener&&document.addEventListener("DOMContentLoaded",sorttable.init,!1),/WebKit/i.test(navigator.userAgent))var _timer=setInterval(function(){/loaded|complete/.test(document.readyState)&&sorttable.init()},10);window.onload=sorttable.init,dean_addEvent.guid=1,fixEvent.preventDefault=function(){this.returnValue=!1},fixEvent.stopPropagation=function(){this.cancelBubble=!0},Array.forEach||(Array.forEach=function(e,t,o){for(var n=0;n<e.length;n++)t.call(o,e[n],n,e)}),Function.prototype.forEach=function(e,t,o){for(var n in e)void 0===this.prototype[n]&&t.call(o,e[n],n,e)},String.forEach=function(o,n,r){Array.forEach(o.split(""),function(e,t){n.call(r,e,t,o)})};var forEach=function(e,t,o){if(e){var n=Object;if(e instanceof Function)n=Function;else{if(e.forEach instanceof Function)return void e.forEach(t,o);"string"==typeof e?n=String:"number"==typeof e.length&&(n=Array)}n.forEach(e,t,o)}};!function(m){if(void 0!==m.ui){m.widget("akottr.dragtable",m.ui.mouse,{options:{revert:!1,dragHandle:".table-handle",maxMovingRows:40,excludeFooter:!1,onlyHeaderThreshold:100,dragaccept:null,persistState:null,restoreState:null,exact:!0,clickDelay:10,containment:null,cursor:"move",cursorAt:!1,distance:50,tolerance:"pointer",axis:"x",beforeStart:m.noop,beforeMoving:m.noop,beforeReorganize:m.noop,beforeStop:m.noop,id:""},originalTable:{el:null,selectedHandle:null,sortOrder:null,startIndex:0,endIndex:0},sortableTable:{el:m(),selectedHandle:m(),movingRow:m()},persistState:function(){var t=this;this.originalTable.el.find("th").each(function(e){""!==this.id&&(t.originalTable.sortOrder[this.id]=e)}),m.ajax({url:this.options.persistState,data:this.originalTable.sortOrder})},_restoreState:function(e){for(var t in e)this.originalTable.startIndex=m("#"+t).closest("th").prevAll().length+1,this.originalTable.endIndex=parseInt(e[t],10)+1,this._bubbleCols()},_bubbleCols:function(){var e,t,o,n,r=this.originalTable.startIndex,s=this.originalTable.endIndex,a=this.originalTable.el.children();if(this.options.excludeFooter&&(a=a.not("tfoot")),r<s)for(e=r;e<s;e++)for(o=a.find("> tr > td:nth-child("+e+")").add(a.find("> tr > th:nth-child("+e+")")),n=a.find("> tr > td:nth-child("+(e+1)+")").add(a.find("> tr > th:nth-child("+(e+1)+")")),t=0;t<o.length;t++)i(o[t],n[t]);else for(e=r;s<e;e--)for(o=a.find("> tr > td:nth-child("+e+")").add(a.find("> tr > th:nth-child("+e+")")),n=a.find("> tr > td:nth-child("+(e-1)+")").add(a.find("> tr > th:nth-child("+(e-1)+")")),t=0;t<o.length;t++)i(o[t],n[t])},_rearrangeTableBackroundProcessing:function(){var e=this;return function(){e._bubbleCols(),e.options.beforeStop(e.originalTable),e.sortableTable.el.remove(),function(){m("#__dragtable_disable_text_selection__").remove(),t?m(document.body).attr("onselectstart",t):m(document.body).removeAttr("onselectstart");o?m(document.body).attr("unselectable",o):m(document.body).removeAttr("unselectable")}(),null!==e.options.persistState&&(m.isFunction(e.options.persistState)?e.options.persistState(e.originalTable):e.persistState())}},_rearrangeTable:function(){var e=this;return function(){e.originalTable.selectedHandle.removeClass("dragtable-handle-selected"),e.sortableTable.el.sortable("disable"),e.sortableTable.el.addClass("dragtable-disabled"),e.options.beforeReorganize(e.originalTable,e.sortableTable),e.originalTable.endIndex=e.sortableTable.movingRow.prevAll().length+1,setTimeout(e._rearrangeTableBackroundProcessing(),50)}},_generateSortable:function(e){!e.cancelBubble&&(e.cancelBubble=!0);for(var r=this,t=this.originalTable.el[0].attributes,s="",o=0;o<t.length;o++)t[o].nodeValue&&"id"!=t[o].nodeName&&"width"!=t[o].nodeName&&(s+=t[o].nodeName+'="'+t[o].nodeValue+'" ');var a=[],i=[];this.originalTable.el.find("tr").slice(0,this.options.maxMovingRows).each(function(e,t){for(var o=this.attributes,n="",r=0;r<o.length;r++)o[r].nodeValue&&"id"!=o[r].nodeName&&(n+=" "+o[r].nodeName+'="'+o[r].nodeValue+'"');a.push(n),i.push(m(this).height())});var n=[],l=0,d=r.originalTable.el.children();if(this.options.excludeFooter&&(d=d.not("tfoot")),d.find("> tr > th").each(function(e,t){var o=m(this).is(":visible")?m(this).outerWidth():0;n.push(o),l+=o}),r.options.exact){var c=l-r.originalTable.el.outerWidth();n[0]-=c}var h='<ul class="dragtable-sortable" style="position:absolute; width:'+(l+=2)+'px;">';d.find("> tr > th").each(function(e,t){var o=m(this).is(":visible")?m(this).outerWidth():0;h+='<li style="width:'+o+'px;">',h+="<table "+s+">";var n=d.find("> tr > th:nth-child("+(e+1)+")");1<r.options.maxMovingRows&&(n=n.add(d.find("> tr > td:nth-child("+(e+1)+")").slice(0,r.options.maxMovingRows-1))),n.each(function(e){var t=m(this).clone().wrap("<div></div>").parent().html();0===t.toLowerCase().indexOf("<th")&&(h+="<thead>"),h+="<tr "+a[e]+'" style="height:'+i[e]+'px;">',h+=t,0===t.toLowerCase().indexOf("<th")&&(h+="</thead>"),h+="</tr>"}),h+="</table>",h+="</li>"}),h+="</ul>",this.sortableTable.el=this.originalTable.el.before(h).prev();r=this;this.sortableTable.el.find("> li > table").each(function(e,t){m(this).css("width",n[e]+"px"),m(this).find(".abminfclick").off("mousedown").on("mousedown",function(e){e.stopPropagation?e.stopPropagation():window.event&&(window.event.cancelBubble=!0);m("#"+r.options.id+"-header").attr("name");var t=m("#"+r.options.id+"-header").attr("evname"),o=m(this).parent(),n="ASC";o.hasClass("abminfdesc")&&(n="DESC"),b4j_raiseEvent("page_parseevent",{eventname:t+"_sortchanged",eventparams:"datafield,order",datafield:o.attr("fieldname"),order:n})}),m(this).find(".abminfclickable").off("mousedown").on("mousedown",function(e){e.stopPropagation?e.stopPropagation():window.event&&(window.event.cancelBubble=!0);m("#"+r.options.id+"-header").attr("name");var t=m("#"+r.options.id+"-header").attr("evname"),o=m(this);b4j_raiseEvent("page_parseevent",{eventname:t+"_headerclicked",eventparams:"datafield",datafield:o.attr("fieldname")})})}),this.sortableTable.selectedHandle=this.sortableTable.el.find("th .dragtable-handle-selected");var b,u=this.options.dragaccept?"li:has("+this.options.dragaccept+")":"li";this.sortableTable.el.sortable({items:u,stop:this._rearrangeTable(),revert:this.options.revert,tolerance:this.options.tolerance,containment:this.options.containment,cursor:this.options.cursor,cursorAt:this.options.cursorAt,distance:this.options.distance,axis:this.options.axis}),this.originalTable.startIndex=m(e.target).closest("th").prevAll().length+1,this.options.beforeMoving(this.originalTable,this.sortableTable),this.sortableTable.movingRow=this.sortableTable.el.find("> li:nth-child("+this.originalTable.startIndex+")"),b=m('<style id="__dragtable_disable_text_selection__" type="text/css">body { -ms-user-select:none;-moz-user-select:-moz-none;-khtml-user-select:none;-webkit-user-select:none;user-select:none; }</style>'),m(document.head).append(b),m(document.body).attr("onselectstart","return false;").attr("unselectable","on"),window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),this.sortableTable.movingRow.trigger(m.extend(m.Event(e.type),{which:1,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY}));var f=this.sortableTable.el.find(".ui-sortable-placeholder");!f.height()<=0&&f.css("height",this.sortableTable.el.find(".ui-sortable-helper").height()),f.html('<div class="outer" style="height:100%;"><div class="inner" style="height:100%;"></div></div>')},bindTo:{},_create:function(){this.originalTable={el:this.element,selectedHandle:m(),sortOrder:{},startIndex:0,endIndex:0},this.bindTo=this.originalTable.el.find("th"),this.options.dragaccept&&(this.bindTo=this.bindTo.filter(this.options.dragaccept)),0<this.bindTo.find(this.options.dragHandle).length&&(this.bindTo=this.bindTo.find(this.options.dragHandle)),null!==this.options.restoreState&&(m.isFunction(this.options.restoreState)?this.options.restoreState(this.originalTable):this._restoreState(this.options.restoreState)),this._mouseInit()},_mouseDown:function(e){if(!1!==this.options.beforeStart(this.originalTable)){clearTimeout(this.downTimer);var t=this;this.downTimer=setTimeout(function(){t.originalTable.selectedHandle=m(this),t.originalTable.selectedHandle.addClass("dragtable-handle-selected"),t._generateSortable(e)},t.options.clickDelay)}},_mouseStop:function(){clearTimeout(this.downTimer)},redraw:function(){this.destroy(),this._create()},destroy:function(){this._mouseDestroy(),m.Widget.prototype.destroy.apply(this,arguments)}});var t=m(document.body).attr("onselectstart"),o=m(document.body).attr("unselectable")}function i(e,t){var o=e.parentNode,n=e.nextSibling===t?e:e.nextSibling;t.parentNode.insertBefore(e,t),o.insertBefore(t,n)}}(jQuery);