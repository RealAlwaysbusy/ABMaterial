!function(){function a(a){this.isMobile=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i),this.isMobile&&(a.autoplay=!1);var b={element:document.getElementsByClassName("aplayer")[0],narrow:!1,autoplay:!1,showlrc:!1,theme:"#b7daff",themename:"default"};for(var c in b)b.hasOwnProperty(c)&&!a.hasOwnProperty(c)&&(a[c]=b[c]);this.playIndex="[object Array]"===Object.prototype.toString.call(a.music)?0:-1,this.option=a,this.audios=[],this.loop=!0}a.prototype.init=function(){function a(a){var b=a||window.event,d=(b.clientX-c(h.bar))/i;d=d>0?d:0,d=1>d?d:1,h.updateBar.call(h,"played",d,"width"),h.option.showlrc&&h.updateLrc.call(h,parseFloat(h.playedBar.style.width)/100*h.audio.duration),h.element.getElementsByClassName("aplayer-ptime")[0].innerHTML=h.secondToTime(d*h.audio.duration)}function b(){document.removeEventListener("mouseup",b),document.removeEventListener("mousemove",a),h.audio.currentTime=parseFloat(h.playedBar.style.width)/100*h.audio.duration,h.play()}function c(a){for(var b,c=a.offsetLeft,d=a.offsetParent;null!==d;)c+=d.offsetLeft,d=d.offsetParent;return b=document.body.scrollLeft+document.documentElement.scrollLeft,c-b}function d(a){for(var b,c=a.offsetTop,d=a.offsetParent;null!==d;)c+=d.offsetTop,d=d.offsetParent;return b=document.body.scrollTop+document.documentElement.scrollTop,c-b}this.element=this.option.element,this.music=this.playIndex>-1?this.option.music[this.playIndex]:this.option.music;var e;if(this.option.showlrc){var f=[];for(e=0;e<this.element.getElementsByClassName("aplayer-lrc-content").length;e++)f.push(this.element.getElementsByClassName("aplayer-lrc-content")[e].innerHTML);this.lrcs=this.parseLrc(f)}var g='<div class="aplayer-pic"><div class="aplayer-button aplayer-button'+this.option.themename+" aplayer-play aplayer-play"+this.option.themename+'"><i class="demo-icon aplayer-icon-play"></i></div></div><div class="aplayer-info aplayer-info'+this.option.themename+'"><div class="aplayer-music"><span class="aplayer-title aplayer-title'+this.option.themename+'"></span><span class="aplayer-author aplayer-author'+this.option.themename+'"></span></div><div class="aplayer-lrc aplayer-lrc'+this.option.themename+'"><div class="aplayer-lrc-contents" style="transform: translateY(0); -webkit-transform: translateY(0);"></div></div><div class="aplayer-controller"><div class="aplayer-bar-wrap"><div class="aplayer-bar aplayer-bar'+this.option.themename+'"><div class="aplayer-loaded aplayer-loaded'+this.option.themename+'" style="width: 0"></div><div class="aplayer-played" style="width: 0; background: '+this.option.theme+';"><span class="aplayer-thumb aplayer-thumb'+this.option.themename+'" style="border: 2px solid '+this.option.theme+';"></span></div></div></div><div class="aplayer-time aplayer-time'+this.option.themename+'"><div class="aplayer-volume-wrap"><i class="demo-icon aplayer-icon-volume-down"></i><div class="aplayer-volume-bar-wrap"><div class="aplayer-volume-bar aplayer-volume-bar'+this.option.themename+'"><div class="aplayer-volume" style="height: 80%; background: '+this.option.theme+';"></div></div></div></div><i class="demo-icon aplayer-icon-loop"></i>'+(this.playIndex>-1?'<i class="demo-icon aplayer-icon-menu"></i>':"")+"</div></div><div class='aplayer-timeparent aplayer-timeparent"+this.option.themename+"' style='padding-top: 11px;font-size: 10px;'><span class='aplayer-ptime aplayer-timeparent"+this.option.themename+"'>00:00</span> / <span class='aplayer-dtime aplayer-timeparent"+this.option.themename+"'>00:00</span></div></div>";if(this.playIndex>-1){for(g+='<div class="aplayer-list aplayer-list'+this.option.themename+'"><ol>',e=0;e<this.option.music.length;e++)g+='<li><span class="aplayer-list-cur" style="background: '+this.option.theme+';"></span><span class="aplayer-list-index aplayer-list-index'+this.option.themename+'" >'+(e+1)+'</span><span class="aplayer-list-title">'+this.option.music[e].title+'</span><span class="aplayer-list-author aplayer-list-author'+this.option.themename+'">'+this.option.music[e].author+"</span></li>";g+="</ol></div>"}this.element.innerHTML=g,this.option.narrow&&this.element.classList.add("aplayer-narrow");var h=this;if(this.button=this.element.getElementsByClassName("aplayer-button")[0],this.button.addEventListener("click",function(){this.classList.contains("aplayer-play")?h.play.call(h):this.classList.contains("aplayer-pause")&&h.pause.call(h)}),this.playIndex>-1)for(e=0;e<this.option.music.length;e++)this.element.getElementsByClassName("aplayer-list")[0].getElementsByTagName("li")[e].addEventListener("click",function(){var a=parseInt(this.getElementsByClassName("aplayer-list-index")[0].innerHTML)-1;a!==h.playIndex&&h.setMusic(a)});this.playedBar=this.element.getElementsByClassName("aplayer-played")[0],this.loadedBar=this.element.getElementsByClassName("aplayer-loaded")[0],this.thumb=this.element.getElementsByClassName("aplayer-thumb")[0],this.bar=this.element.getElementsByClassName("aplayer-bar")[0];var i;this.bar.addEventListener("click",function(a){var b=a||window.event;i=h.bar.clientWidth;var d=(b.clientX-c(h.bar))/i;h.updateBar.call(h,"played",d,"width"),h.element.getElementsByClassName("aplayer-ptime")[0].innerHTML=h.secondToTime(d*h.audio.duration),h.audio.currentTime=parseFloat(h.playedBar.style.width)/100*h.audio.duration}),this.thumb.addEventListener("mouseover",function(){this.style.background=h.option.theme}),this.thumb.addEventListener("mouseout",function(){this.style.background="#fff"}),this.thumb.addEventListener("mousedown",function(){i=h.bar.clientWidth,clearInterval(h.playedTime),document.addEventListener("mousemove",a),document.addEventListener("mouseup",b)}),this.volumeBar=this.element.getElementsByClassName("aplayer-volume")[0];var j=this.element.getElementsByClassName("aplayer-volume-bar")[0],k=h.element.getElementsByClassName("aplayer-time")[0].getElementsByTagName("i")[0],l=35;this.element.getElementsByClassName("aplayer-volume-bar-wrap")[0].addEventListener("click",function(a){var b=a||window.event,c=(l-b.clientY+d(j))/l;c=c>0?c:0,c=1>c?c:1,h.updateBar.call(h,"volume",c,"height"),h.audio.volume=c,h.audio.muted&&(h.audio.muted=!1),1===c?k.className="demo-icon aplayer-icon-volume-up":k.className="demo-icon aplayer-icon-volume-down"}),k.addEventListener("click",function(){h.audio.muted?(h.audio.muted=!1,k.className=1===h.audio.volume?"demo-icon aplayer-icon-volume-up":"demo-icon aplayer-icon-volume-down",h.updateBar.call(h,"volume",h.audio.volume,"height")):(h.audio.muted=!0,k.className="demo-icon aplayer-icon-volume-off",h.updateBar.call(h,"volume",0,"height"))}),this.element.getElementsByClassName("aplayer-icon-loop")[0].addEventListener("click",function(){h.loop?(this.classList.add("aplayer-noloop"),this.classList.add("aplayer-noloop"+this.option.themename),h.loop=!1,h.audio.loop=!(h.playIndex>-1)&&h.loop):(this.classList.remove("aplayer-noloop"),this.classList.remove("aplayer-noloop"+this.option.themename),h.loop=!0,h.audio.loop=!(h.playIndex>-1)&&h.loop)}),this.playIndex>-1&&this.element.getElementsByClassName("aplayer-icon-menu")[0].addEventListener("click",function(){var a=h.element.getElementsByClassName("aplayer-list")[0];a.classList.contains("aplayer-list-hide")?a.classList.remove("aplayer-list-hide"):a.classList.add("aplayer-list-hide")}),this.setMusic(0)},a.prototype.setMusic=function(a){this.playIndex>-1&&"undefined"!=typeof arguments[0]&&(this.playIndex=arguments[0]);var c,b=this.playIndex;if(this.music=this.playIndex>-1?this.option.music[b]:this.option.music,this.music.pic&&(this.element.getElementsByClassName("aplayer-pic")[0].style.backgroundImage="url("+encodeURI(this.music.pic)+")"),this.element.getElementsByClassName("aplayer-title")[0].innerHTML=this.music.title,this.element.getElementsByClassName("aplayer-author")[0].innerHTML=" - "+this.music.author,this.playIndex>-1&&(this.element.getElementsByClassName("aplayer-list-light")[0]&&this.element.getElementsByClassName("aplayer-list-light")[0].classList.remove("aplayer-list-light"),this.element.getElementsByClassName("aplayer-list")[0].getElementsByTagName("li")[b].classList.add("aplayer-list-light")),this.playIndex>-1&&(this.element.getElementsByClassName("aplayer-list-light"+this.option.themename)[0]&&this.element.getElementsByClassName("aplayer-list-light"+this.option.themename)[0].classList.remove("aplayer-list-light"+this.option.themename),this.element.getElementsByClassName("aplayer-list"+this.option.themename)[0].getElementsByTagName("li")[b].classList.add("aplayer-list-light"+this.option.themename)),this.audio&&(this.pause(),this.audio.currentTime=0),this.playIndex>-1&&!this.audios[b]||-1===this.playIndex){if(c=this,c.audio=document.createElement("audio"),c.audio.src=this.music.url,c.audio.preload=c.isMobile?"none":"metadata",c.audio.addEventListener("loadeddata",function(){c.audio.removeEventListener("loadeddata",function(){}),c.option.autoplay&&!c.isMobile&&c.play(),c.option.autoplay=!0,c.isMobile&&c.pause()}),c.audio.addEventListener("durationchange",function(){1!==c.audio.duration&&(c.element.getElementsByClassName("aplayer-dtime")[0].innerHTML=c.secondToTime(c.audio.duration))}),c.audio.addEventListener("progress",function(){var a=c.audio.buffered.length?c.audio.buffered.end(c.audio.buffered.length-1)/c.audio.duration:0;c.updateBar.call(c,"loaded",a,"width")}),c.audio.addEventListener("error",function(){c.element.getElementsByClassName("aplayer-author")[0].innerHTML=" - Error happens -?-"}),c.playIndex>-1?c.audio.addEventListener("ended",function(){c.playIndex<c.option.music.length-1?c.setMusic(++c.playIndex):c.loop?c.setMusic(0):c.loop||c.pause()}):c.audio.addEventListener("ended",function(){c.loop||c.pause()}),c.audio.volume=parseInt(c.element.getElementsByClassName("aplayer-volume")[0].style.height)/100,c.audio.loop=!(c.playIndex>-1)&&c.loop,c.playIndex>-1&&(c.audios[b]=c.audio),c.option.showlrc)if(c.lrc=c.playIndex>-1?c.lrcs[b]:c.lrcs[0],void 0==c.lrc)c.lrcContents=c.element.getElementsByClassName("aplayer-lrc-contents")[0],c.lrcContents.innerHTML="";else{c.element.classList.add("aplayer-withlrc");var d="";c.lrcContents=c.element.getElementsByClassName("aplayer-lrc-contents")[0];for(var e=0;e<c.lrc.length;e++)d+="<p>"+c.lrc[e][1]+"</p>";c.lrcContents.innerHTML=d,c.lrcContents.innerHTML=d,c.lrcIndex||(c.lrcIndex=0),c.lrcContents.getElementsByTagName("p")[0].classList.add("aplayer-lrc-current"),c.lrcContents.style.transform="translateY(0px)",c.lrcContents.style.webkitTransform="translateY(0px)"}1!==c.audio.duration&&(c.element.getElementsByClassName("aplayer-dtime")[0].innerHTML=c.audio.duration?c.secondToTime(c.audio.duration):"00:00")}else this.audio=this.audios[b],this.audio.volume=parseInt(this.element.getElementsByClassName("aplayer-volume")[0].style.height)/100,this.audio.currentTime=0},a.prototype.play=function(){var a=this;this.button.classList.remove("aplayer-play"),this.button.classList.remove("aplayer-play"+this.option.themename),this.button.classList.add("aplayer-pause"),this.button.classList.add("aplayer-pause"+this.option.themename),this.button.innerHTML="",setTimeout(function(){a.button.innerHTML='<i class="demo-icon aplayer-icon-pause"></i>'},100),this.audio.play(),this.playedTime&&clearInterval(this.playedTime),this.playedTime=setInterval(function(){a.updateBar.call(a,"played",a.audio.currentTime/a.audio.duration,"width"),a.option.showlrc&&a.updateLrc.call(a),a.element.getElementsByClassName("aplayer-ptime")[0].innerHTML=a.secondToTime(a.audio.currentTime)},100)},a.prototype.pause=function(){var a=this;this.button.classList.remove("aplayer-pause"),this.button.classList.remove("aplayer-pause"+this.option.themename),this.button.classList.add("aplayer-play"),this.button.classList.add("aplayer-play"+this.option.themename),this.button.innerHTML="",setTimeout(function(){a.button.innerHTML='<i class="demo-icon aplayer-icon-play"></i>'},100),this.audio.pause(),clearInterval(this.playedTime)},a.prototype.updateBar=function(a,b,c){b=b>0?b:0,b=1>b?b:1,this[a+"Bar"].style[c]=100*b+"%"},a.prototype.updateLrc=function(a){if(void 0!=this.lrc&&("undefined"==typeof arguments[0]&&(a=this.audio.currentTime),this.lrcIndex>this.lrc.length-1||a<this.lrc[this.lrcIndex][0]||!this.lrc[this.lrcIndex+1]||a>=this.lrc[this.lrcIndex+1][0]))for(var b=0;b<this.lrc.length;b++)a>=this.lrc[b][0]&&(!this.lrc[b+1]||a<this.lrc[b+1][0])&&(this.lrcIndex=b,this.lrcContents.style.transform="translateY("+20*-this.lrcIndex+"px)",this.lrcContents.style.webkitTransform="translateY("+20*-this.lrcIndex+"px)",this.lrcContents.getElementsByClassName("aplayer-lrc-current")[0].classList.remove("aplayer-lrc-current"),this.lrcContents.getElementsByTagName("p")[b].classList.add("aplayer-lrc-current"))},a.prototype.secondToTime=function(a){var b=function(a){return 10>a?"0"+a:""+a},c=parseInt(a/60),d=parseInt(a-60*c);return b(c)+":"+b(d)},a.prototype.parseLrc=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c].split("\n"),e=[],f=d.length,g=0;f>g;g++){var h=d[g].match(/\[(\d{2}):(\d{2})\.(\d{2,3})]/g),i=d[g].replace(/\[(\d{2}):(\d{2})\.(\d{2,3})]/g,"").replace(/^\s+|\s+$/g,"");if(null!=h)for(var j=h.length,k=0;j>k;k++){var l=/\[(\d{2}):(\d{2})\.(\d{2,3})]/.exec(h[k]),m=60*l[1]+parseInt(l[2])+parseInt(l[3])/(2===(l[3]+"").length?100:1e3);e.push([m,i])}}e.sort(function(a,b){return a[0]-b[0]}),b.push(e)}return b},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:window.APlayer=a}();