!function(o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof exports?module.exports=o(require("jquery")):o(jQuery)}(function(b){var v="tinycolorpicker",x={colors:["#ffffff","#A7194B","#FE2712","#FB9902","#FABC02","#FEFE33","#D0EA2B","#66B032","#0391CE","#0247FE","#3D01A5","#8601AF"],backgroundUrl:null};function e(t,o){this.options=b.extend({},x,o),this._defaults=x,this._name=v;var e,n,r,c=this,i=t.find(".track"),a=t.find(".color"),u=null,s=t.find(".colorInput"),l=t.find(".dropdown"),d=l.find("li").remove(),f=null,g=!1,h=!!document.createElement("canvas").getContext,p="ontouchstart"in document.documentElement;function m(o){if(g){var e=b(o.target).offset(),n=f.getImageData(o.pageX-e.left,o.pageY-e.top,1,1).data;if(0==n[0]&&0==n[1]&&0==n[2])return;c.setColor("rgb("+n[0]+","+n[1]+","+n[2]+")"),t.trigger("change",[c.colorHex,c.colorRGB]),b4j_raiseEvent("page_parseevent",{eventname:c.parentid+"_changed",eventparams:"color",color:c.colorHex})}}return this.parentid=t.parent().attr("id"),this.colorHex="",this.colorRGB="",this.setColor=function(o){0<=o.indexOf("#")?(c.colorHex=o,c.colorRGB=c.hexToRgb(c.colorHex)):(c.colorRGB=o,c.colorHex=c.rgbToHex(c.colorRGB)),a.find(".colorInner").css("backgroundColor",c.colorHex),s.val(c.colorHex)},this.close=function(){g=!1,i.hide()},this.hexToRgb=function(o){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return"rgb("+parseInt(e[1],16)+","+parseInt(e[2],16)+","+parseInt(e[3],16)+")"},this.rgbToHex=function(o){var e=o.match(/\d+/g);function n(o){var e=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");return isNaN(o)?"00":e[(o-o%16)/16]+e[o%16]}return"#"+n(e[0])+n(e[1])+n(e[2])},h?(u=b("<canvas></canvas>"),i.append(u),f=u[0].getContext("2d"),e=new Image,n=i.css("background-image").replace(/"/g,"").replace(/url\(|\)$/gi,""),e.crossOrigin="Anonymous",i.css("background-image","none"),b(e).load(function(){u.attr("width",this.width),u.attr("height",this.height),f.drawImage(e,0,0,this.width,this.height)}),e.src=c.options.backgroundUrl||n):b.each(c.options.colors,function(o,e){var n=d.clone();n.css("backgroundColor",e),n.attr("data-color",e),l.append(n)}),r=p?"touchstart mousedown":"mousedown",h?(a.bind(r,function(o){o.preventDefault(),o.stopPropagation(),i.toggle(),b(document).bind("mousedown.colorpicker",function(o){b(document).unbind(".colorpicker"),c.close()})}),u.mousedown(function(o){return g=!0,m(o),b(document).bind("mouseup.colorpicker",function(o){return b(document).unbind(".colorpicker"),c.close(),!1}),!1}),u.mousemove(m),p&&(u.bind("touchstart",function(o){return g=!0,m(o.originalEvent.touches[0]),!1}),u.bind("touchmove",function(o){return m(o.originalEvent.touches[0]),!1}),u.bind("touchend",function(o){return c.close(),!1}))):(a.bind("mousedown",function(o){o.preventDefault(),o.stopPropagation(),l.toggle()}),l.delegate("li","mousedown",function(o){o.preventDefault(),o.stopImmediatePropagation();var e=b(this).attr("data-color");c.setColor(e),l.hide()})),""!=c.options.color&&(c.colorHex=c.options.color,c.colorRGB=c.hexToRgb(c.colorHex),a.find(".colorInner").css("backgroundColor",c.colorHex),s.val(c.colorHex)),c}b.fn[v]=function(o){return this.each(function(){b.data(this,"plugin_"+v)||b.data(this,"plugin_"+v,new e(b(this),o))})}});