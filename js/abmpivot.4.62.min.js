(function(){var ot=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1},v=[].slice,g=function(t,n){return function(){return t.apply(n,arguments)}},it={}.hasOwnProperty;(function(t){"object"==typeof exports&&"object"==typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(Q){var Z,r,p,t,e,n,i,G,s,tt,a,h,o,l,u,c,f,d,nt,et,rt,at,m;return r=function(t,n,e){var r,a,o,i;for(o=(a=(t+="").split("."))[0],i=1<a.length?e+a[1]:"",r=/(\d+)(\d{3})/;r.test(o);)o=o.replace(r,"$1"+n+"$2");return o+i},u=(a=function(e){var t;return t={digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:"",showZero:!1},e=Q.extend({},t,e),function(t){var n;return isNaN(t)||!isFinite(t)?"":0!==t||e.showZero?(n=r((e.scaler*t).toFixed(e.digitsAfterDecimal),e.thousandsSep,e.decimalSep),""+e.prefix+n+e.suffix):""}})(),c=a({digitsAfterDecimal:0}),f=a({digitsAfterDecimal:1,scaler:100,suffix:"%"}),t={Count:(m=p={count:function(r){return null==r&&(r=c),function(){return function(t,n,e){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:r}}}},countUnique:function(a){return null==a&&(a=c),function(t){var r;return r=t[0],function(t,n,e){return{uniq:[],push:function(t){var n;if(n=t[r],ot.call(this.uniq,n)<0)return this.uniq.push(t[r])},value:function(){return this.uniq.length},format:a,numInputs:null!=r?0:1}}}},listUnique:function(a){return function(t){var r;return r=t[0],function(t,n,e){return{uniq:[],push:function(t){var n;if(n=t[r],ot.call(this.uniq,n)<0)return this.uniq.push(t[r])},value:function(){return this.uniq.join(a)},format:function(t){return t},numInputs:null!=r?0:1}}}},sum:function(a){return null==a&&(a=u),function(t){var r;return r=t[0],function(t,n,e){return{sum:0,push:function(t){if(!isNaN(parseFloat(t[r])))return this.sum+=parseFloat(t[r])},value:function(){return this.sum},format:a,numInputs:null!=r?0:1}}}},min:function(a){return null==a&&(a=u),function(t){var r;return r=t[0],function(t,n,e){return{val:null,push:function(t){var n,e;if(e=parseFloat(t[r]),!isNaN(e))return this.val=Math.min(e,null!=(n=this.val)?n:e)},value:function(){return this.val},format:a,numInputs:null!=r?0:1}}}},max:function(a){return null==a&&(a=u),function(t){var r;return r=t[0],function(t,n,e){return{val:null,push:function(t){var n,e;if(e=parseFloat(t[r]),!isNaN(e))return this.val=Math.max(e,null!=(n=this.val)?n:e)},value:function(){return this.val},format:a,numInputs:null!=r?0:1}}}},first:function(a){return null==a&&(a=u),function(t){var r;return r=t[0],function(t,n,e){return{val:null,sorter:i(null!=t?t.sorters:void 0,r),push:function(t){var n,e;if(e=t[r],this.sorter(e,null!=(n=this.val)?n:e)<=0)return this.val=e},value:function(){return this.val},format:function(t){return isNaN(t)?t:a(t)},numInputs:null!=r?0:1}}}},last:function(a){return null==a&&(a=u),function(t){var r;return r=t[0],function(t,n,e){return{val:null,sorter:i(null!=t?t.sorters:void 0,r),push:function(t){var n,e;if(e=t[r],0<=this.sorter(e,null!=(n=this.val)?n:e))return this.val=e},value:function(){return this.val},format:function(t){return isNaN(t)?t:a(t)},numInputs:null!=r?0:1}}}},average:function(a){return null==a&&(a=u),function(t){var r;return r=t[0],function(t,n,e){return{sum:0,len:0,push:function(t){if(!isNaN(parseFloat(t[r])))return this.sum+=parseFloat(t[r]),this.len++},value:function(){return this.sum/this.len},format:a,numInputs:null!=r?0:1}}}},sumOverSum:function(o){return null==o&&(o=u),function(t){var r,a;return a=t[0],r=t[1],function(t,n,e){return{sumNum:0,sumDenom:0,push:function(t){if(isNaN(parseFloat(t[a]))||(this.sumNum+=parseFloat(t[a])),!isNaN(parseFloat(t[r])))return this.sumDenom+=parseFloat(t[r])},value:function(){return this.sumNum/this.sumDenom},format:o,numInputs:null!=a&&null!=r?0:2}}}},sumOverSumBound80:function(o,i){return null==o&&(o=!0),null==i&&(i=u),function(t){var r,a;return a=t[0],r=t[1],function(t,n,e){return{sumNum:0,sumDenom:0,push:function(t){if(isNaN(parseFloat(t[a]))||(this.sumNum+=parseFloat(t[a])),!isNaN(parseFloat(t[r])))return this.sumDenom+=parseFloat(t[r])},value:function(){var t;return t=o?1:-1,(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*t*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:i,numInputs:null!=a&&null!=r?0:2}}}},fractionOf:function(a,o,i){return null==o&&(o="total"),null==i&&(i=f),function(){var r;return r=1<=arguments.length?v.call(arguments,0):[],function(t,n,e){return{selector:{total:[[],[]],row:[n,[]],col:[[],e]}[o],inner:a.apply(null,r)(t,n,e),push:function(t){return this.inner.push(t)},format:i,value:function(){return this.inner.value()/t.getAggregator.apply(t,this.selector).inner.value()},numInputs:a.apply(null,r)().numInputs}}}}}).count(c),"Count Unique Values":m.countUnique(c),"List Unique Values":m.listUnique(", "),Sum:m.sum(u),"Integer Sum":m.sum(c),Average:m.average(u),Minimum:m.min(u),Maximum:m.max(u),First:m.first(u),Last:m.last(u),"Sum over Sum":m.sumOverSum(u),"80% Upper Bound":m.sumOverSumBound80(!0,u),"80% Lower Bound":m.sumOverSumBound80(!1,u),"Sum as Fraction of Total":m.fractionOf(m.sum(),"total",f),"Sum as Fraction of Rows":m.fractionOf(m.sum(),"row",f),"Sum as Fraction of Columns":m.fractionOf(m.sum(),"col",f),"Count as Fraction of Total":m.fractionOf(m.count(),"total",f),"Count as Fraction of Rows":m.fractionOf(m.count(),"row",f),"Count as Fraction of Columns":m.fractionOf(m.count(),"col",f)},G={en:{aggregators:t,renderers:o={Table:function(t,n){return h(t,n)},"Table Barchart":function(t,n){return Q(h(t,n)).barchart()},Heatmap:function(t,n){return Q(h(t,n)).heatmap("heatmap",n)},"Row Heatmap":function(t,n){return Q(h(t,n)).heatmap("rowheatmap",n)},"Col Heatmap":function(t,n){return Q(h(t,n)).heatmap("colheatmap",n)}},localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Select All",selectNone:"Select None",tooMany:"(too many to list)",filterResults:"Filter values",apply:"Apply",cancel:"Cancel",totals:"Totals",vs:"vs",by:"by"}}},s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d=function(t){return("0"+t).substr(-2,2)},n={bin:function(n,e){return function(t){return t[n]-t[n]%e}},dateFormat:function(n,r,t,a,o){var i;return null==t&&(t=!1),null==a&&(a=s),null==o&&(o=e),i=t?"UTC":"",function(t){var e;return e=new Date(Date.parse(t[n])),isNaN(e)?"":r.replace(/%(.)/g,function(t,n){switch(n){case"y":return e["get"+i+"FullYear"]();case"m":return d(e["get"+i+"Month"]()+1);case"n":return a[e["get"+i+"Month"]()];case"d":return d(e["get"+i+"Date"]());case"w":return o[e["get"+i+"Day"]()];case"x":return e["get"+i+"Day"]();case"H":return d(e["get"+i+"Hours"]());case"M":return d(e["get"+i+"Minutes"]());case"S":return d(e["get"+i+"Seconds"]());default:return"%"+n}})}}},tt=function(t,n){var e,r,a,o,i,s,l;if(s=/(\d+)|(\D+)/g,i=/\d/,l=/^0/,"number"==typeof t||"number"==typeof n)return isNaN(t)?1:isNaN(n)?-1:t-n;if((e=String(t))===(a=String(n)))return 0;if(!i.test(e)||!i.test(a))return a<e?1:-1;for(e=e.match(s),a=a.match(s);e.length&&a.length;)if((r=e.shift())!==(o=a.shift()))return i.test(r)&&i.test(o)?r.replace(l,".0")-o.replace(l,".0"):o<r?1:-1;return e.length-a.length},l=function(t){var n,e,r,a;for(n in r={},e={},t)a=t[n],r[a]=n,"string"==typeof a&&(e[a.toLowerCase()]=n);return function(t,n){return null!=r[t]&&null!=r[n]?r[t]-r[n]:null!=r[t]?-1:null!=r[n]?1:null!=e[t]&&null!=e[n]?e[t]-e[n]:null!=e[t]?-1:null!=e[n]?1:tt(t,n)}},i=function(t,n){var e;if(null!=t)if(Q.isFunction(t)){if(e=t(n),Q.isFunction(e))return e}else if(null!=t[n])return t[n];return tt},Z=function(){function h(t,n){var e,r,a,o,i,s,l,u,c;null==n&&(n={}),this.getAggregator=g(this.getAggregator,this),this.getRowKeys=g(this.getRowKeys,this),this.getColKeys=g(this.getColKeys,this),this.sortKeys=g(this.sortKeys,this),this.arrSort=g(this.arrSort,this),this.input=t,this.aggregator=null!=(e=n.aggregator)?e:p.count()(),this.aggregatorName=null!=(r=n.aggregatorName)?r:"Count",this.colAttrs=null!=(a=n.cols)?a:[],this.rowAttrs=null!=(o=n.rows)?o:[],this.valAttrs=null!=(i=n.vals)?i:[],this.sorters=null!=(s=n.sorters)?s:{},this.derivedAttributes=null!=(l=n.derivedAttributes)?l:{},this.filter=null!=(u=n.filter)?u:function(){return!0},this.tree={},this.rowKeys=[],this.colKeys=[],this.rowTotals={},this.colTotals={},this.allTotal=this.aggregator(this,[],[]),this.sorted=!1,h.forEachRecord(this.input,this.derivedAttributes,(c=this,function(t){if(c.filter(t))return c.processRecord(t)}))}return h.forEachRecord=function(t,a,o){var n,e,r,i,s,l,u,c,h,p,f,d;if(n=Q.isEmptyObject(a)?o:function(t){var n,e,r;for(n in a)r=a[n],t[n]=null!=(e=r(t))?e:t[n];return o(t)},Q.isFunction(t))return t(n);if(Q.isArray(t)){if(Q.isArray(t[0])){for(r in p=[],t)if(it.call(t,r)&&(e=t[r],0<r)){for(i in c={},h=t[0])it.call(h,i)&&(s=h[i],c[s]=e[i]);p.push(n(c))}return p}for(f=[],l=0,u=t.length;l<u;l++)c=t[l],f.push(n(c));return f}if(t instanceof jQuery)return d=[],Q("thead > tr > th",t).each(function(t){return d.push(Q(this).text())}),Q("tbody > tr",t).each(function(t){return c={},Q("td",this).each(function(t){return c[d[t]]=Q(this).text()}),n(c)});throw new Error("unknown input format")},h.prototype.forEachMatchingRecord=function(r,a){return h.forEachRecord(this.input,this.derivedAttributes,(o=this,function(t){var n,e;if(o.filter(t)){for(n in r)if(r[n]!==(null!=(e=t[n])?e:"null"))return;return a(t)}}));var o},h.prototype.arrSort=function(r){var a,o;return o=function(){var t,n,e;for(e=[],t=0,n=r.length;t<n;t++)a=r[t],e.push(i(this.sorters,a));return e}.call(this),function(t,n){var e,r;for(r in o)if(it.call(o,r)&&0!==(e=(0,o[r])(t[r],n[r])))return e;return 0}},h.prototype.sortKeys=function(){if(!this.sorted)return this.sorted=!0,this.rowKeys.sort(this.arrSort(this.rowAttrs)),this.colKeys.sort(this.arrSort(this.colAttrs))},h.prototype.getColKeys=function(){return this.sortKeys(),this.colKeys},h.prototype.getRowKeys=function(){return this.sortKeys(),this.rowKeys},h.prototype.processRecord=function(t){var n,e,r,a,o,i,s,l,u,c,h,p,f;for(n=[],p=[],a=0,o=(l=this.colAttrs).length;a<o;a++)f=l[a],n.push(null!=(u=t[f])?u:"null");for(s=0,i=(c=this.rowAttrs).length;s<i;s++)f=c[s],p.push(null!=(h=t[f])?h:"null");if(r=p.join(String.fromCharCode(0)),e=n.join(String.fromCharCode(0)),this.allTotal.push(t),0!==p.length&&(this.rowTotals[r]||(this.rowKeys.push(p),this.rowTotals[r]=this.aggregator(this,p,[])),this.rowTotals[r].push(t)),0!==n.length&&(this.colTotals[e]||(this.colKeys.push(n),this.colTotals[e]=this.aggregator(this,[],n)),this.colTotals[e].push(t)),0!==n.length&&0!==p.length)return this.tree[r]||(this.tree[r]={}),this.tree[r][e]||(this.tree[r][e]=this.aggregator(this,p,n)),this.tree[r][e].push(t)},h.prototype.getAggregator=function(t,n){var e,r,a;return a=t.join(String.fromCharCode(0)),r=n.join(String.fromCharCode(0)),null!=(e=0===t.length&&0===n.length?this.allTotal:0===t.length?this.colTotals[r]:0===n.length?this.rowTotals[a]:this.tree[a][r])?e:{value:function(){return null},format:function(){return""}}},h}(),Q.pivotUtilities={aggregatorTemplates:p,aggregators:t,renderers:o,derivers:n,locales:G,naturalSort:tt,numberFormat:a,sortAs:l,PivotData:Z},h=function(i,s){var t,n,l,e,r,a,o,u,c,h,p,f,d,m,v,g,C,b,A,w,y,S,T,x;for(c in indexOf=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1},slice=[].slice,bind=function(t,n){return function(){return t.apply(n,arguments)}},hasProp={}.hasOwnProperty,a={table:{clickCallback:null,rowTotals:!0,colTotals:!0},localeStrings:{totals:"Totals"}},s=$.extend(!0,{},a,s),l=i.colAttrs,f=i.rowAttrs,m=i.getRowKeys(),r=i.getColKeys(),s.table.clickCallback&&(o=function(n,t,e){var r,a,o;for(o in a={},l)hasProp.call(l,o)&&(r=l[o],null!=e[o]&&(a[r]=e[o]));for(o in f)hasProp.call(f,o)&&(r=f[o],null!=t[o]&&(a[r]=t[o]));return function(t){return s.table.clickCallback(t,n,a,i)}}),(p=document.createElement("table")).className="pvtTable",v=function(t,n,e){var r,a,o,i,s,l,u,c;if(0!==n){for(i=!0,c=r=0,s=e;0<=s?r<=s:s<=r;c=0<=s?++r:--r)t[n-1][c]!==t[n][c]&&(i=!1);if(i)return-1}for(a=0;n+a<t.length;){for(u=!1,c=o=0,l=e;0<=l?o<=l:l<=o;c=0<=l?++o:--o)t[n][c]!==t[n+a][c]&&(u=!0);if(u)break;a++}return a},A=document.createElement("thead"),l)if(hasProp.call(l,c)){for(u in n=l[c],y=document.createElement("tr"),0===parseInt(c)&&0!==f.length&&((b=document.createElement("th")).setAttribute("colspan",f.length),b.setAttribute("rowspan",l.length),y.appendChild(b)),(b=document.createElement("th")).className="pvtAxisLabel",b.textContent=n,y.appendChild(b),r)hasProp.call(r,u)&&(e=r[u],-1!==(x=v(r,parseInt(u),parseInt(c)))&&((b=document.createElement("th")).className="pvtColLabel",b.textContent=e[c],b.setAttribute("colspan",x),parseInt(c)===l.length-1&&0!==f.length&&b.setAttribute("rowspan",2),y.appendChild(b)));0===parseInt(c)&&s.table.rowTotals&&((b=document.createElement("th")).className="pvtTotalLabel pvtRowTotalLabel",b.innerHTML=s.localeStrings.totals,b.setAttribute("rowspan",l.length+(0===f.length?0:1)),y.appendChild(b)),A.appendChild(y)}if(0!==f.length){for(u in y=document.createElement("tr"),f)hasProp.call(f,u)&&(h=f[u],(b=document.createElement("th")).className="pvtAxisLabel",b.textContent=h,y.appendChild(b));b=document.createElement("th"),0===l.length&&(b.className="pvtTotalLabel pvtRowTotalLabel",b.innerHTML=s.localeStrings.totals),y.appendChild(b),A.appendChild(y)}for(u in p.appendChild(A),g=document.createElement("tbody"),m)if(hasProp.call(m,u)){for(c in d=m[u],y=document.createElement("tr"),d)hasProp.call(d,c)&&(S=d[c],-1!==(x=v(m,parseInt(u),parseInt(c)))&&((b=document.createElement("th")).className="pvtRowLabel",b.textContent=S,b.setAttribute("rowspan",x),parseInt(c)===f.length-1&&0!==l.length&&b.setAttribute("colspan",2),y.appendChild(b)));for(c in r)hasProp.call(r,c)&&(e=r[c],T=(t=i.getAggregator(d,e)).value(),(C=document.createElement("td")).className="pvtVal row"+u+" col"+c,C.textContent=t.format(T),C.setAttribute("data-value",T),null!=o&&(C.onclick=o(T,d,e)),y.appendChild(C));(s.table.rowTotals||0===l.length)&&(T=(w=i.getAggregator(d,[])).value(),(C=document.createElement("td")).className="pvtTotal rowTotal",C.textContent=w.format(T),C.setAttribute("data-value",T),null!=o&&(C.onclick=o(T,d,[])),C.setAttribute("data-for","row"+u),y.appendChild(C)),g.appendChild(y)}if(s.table.colTotals||0===f.length){for(c in y=document.createElement("tr"),(s.table.colTotals||0===f.length)&&((b=document.createElement("th")).className="pvtTotalLabel pvtColTotalLabel",b.innerHTML=s.localeStrings.totals,b.setAttribute("colspan",f.length+(0===l.length?0:1)),y.appendChild(b)),r)hasProp.call(r,c)&&(e=r[c],T=(w=i.getAggregator([],e)).value(),(C=document.createElement("td")).className="pvtTotal colTotal",C.textContent=w.format(T),C.setAttribute("data-value",T),null!=o&&(C.onclick=o(T,[],e)),C.setAttribute("data-for","col"+c),y.appendChild(C));(s.table.rowTotals||0===l.length)&&(T=(w=i.getAggregator([],[])).value(),(C=document.createElement("td")).className="pvtGrandTotal",C.textContent=w.format(T),C.setAttribute("data-value",T),null!=o&&(C.onclick=o(T,[],[])),y.appendChild(C)),g.appendChild(y)}return p.appendChild(g),p.setAttribute("data-numrows",m.length),p.setAttribute("data-numcols",r.length),p},Q.fn.pivot=function(t,n,e){var r,a,o,i,s,l,u,c;null==e&&(e="en"),null==G[e]&&(e="en"),r={cols:[],rows:[],hides:[],vals:[],dataClass:Z,heatcol:"#FF0000",barchartcol:"#FF0000",filter:function(){return!0},aggregator:p.count()(),aggregatorName:"Count",sorters:{},derivedAttributes:{},renderer:h},o={rendererOptions:{localeStrings:i=Q.extend(!0,{},G.en.localeStrings,G[e].localeStrings)},localeStrings:i},s=Q.extend(!0,{},o,Q.extend({},r,n)),u=null;try{l=new s.dataClass(t,s);try{u=s.renderer(l,s.rendererOptions)}catch(t){a=t,"undefined"!=typeof console&&null!==console&&console.error(a.stack),u=Q("<span>").html(s.localeStrings.renderError)}}catch(t){a=t,"undefined"!=typeof console&&null!==console&&console.error(a.stack),u=Q("<span>").html(s.localeStrings.computeError)}for(c=this[0];c.hasChildNodes();)c.removeChild(c.lastChild);return this.append(u)},Q.fn.pivotUI=function(t,n,e,r){var a,d,m,o,i,s,l,u,c,v,g,h,p,f,C,b,A,w,y,S,T,x,N,F,R,M,E,I,L,D,O,U,k,V,q,H,K,P,B;null==e&&(e=!1),null==r&&(r="en"),null==G[r]&&(r="en"),s={derivedAttributes:{},aggregators:G[r].aggregators,renderers:G[r].renderers,hiddenAttributes:[],menuLimit:500,cols:[],rows:[],hides:[],vals:[],rendererChanged:null,dataClass:Z,exclusions:{},inclusions:{},heatcol:"#FF0000",barchartcol:"#FF0000",unusedAttrsVertical:85,autoSortUnusedAttrs:!1,rendererOptions:{localeStrings:G[r].localeStrings},onRefresh:null,filter:function(){return!0},sorters:{}},b={rendererOptions:{localeStrings:A=Q.extend(!0,{},G.en.localeStrings,G[r].localeStrings)},localeStrings:A};var j={Table:"Table","Table Barchart":"Table Barchart",Heatmap:"Heatmap","Row Heatmap":"Row Heatmap","Col Heatmap":"Col Heatmap","Table With Subtotal":"Table","Table With Subtotal Bar Chart":"Table Barchart","Table With Subtotal Heatmap":"Heatmap","Table With Subtotal Row Heatmap":"Row Heatmap","Table With Subtotal Col Heatmap":"Col Heatmap","TSV Export":"TSV Export","Line Chart":"Line Chart","Bar Chart":"Bar Chart","Stacked Bar Chart":"Stacked Bar Chart","Area Chart":"Area Chart","Scatter Chart":"Scatter Chart"},W={Count:"Count","Count Unique Values":"Count Unique Values","List Unique Values":"List Unique Values",Sum:"Sum","Integer Sum":"Integer Sum",Average:"Average",Minimum:"Minimum",Maximum:"Maximum",First:"First",Last:"Last","Sum over Sum":"Sum over Sum","80% Upper Bound":"80% Upper Bound","80% Lower Bound":"80% Lower Bound","Sum as Fraction of Total":"Sum as Fraction of Total","Sum as Fraction of Rows":"Sum as Fraction of Rows","Sum as Fraction of Columns":"Sum as Fraction of Columns","Count as Fraction of Total":"Count as Fraction of Total","Count as Fraction of Rows":"Count as Fraction of Rows","Count as Fraction of Columns":"Count as Fraction of Columns"};G[r]&&(G[r].renderersMap&&(j=G[r].renderersMap),G[r].aggregatorsMap&&(W=G[r].aggregatorsMap)),u=this.data("pivotUIOptions"),T=null==u||e?Q.extend(!0,{},b,Q.extend({},s,n)):u;var Y,$,_,J=(Y=T.heatcol,($=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(Y))?{r:parseInt($[1],16),g:parseInt($[2],16),b:parseInt($[3],16)}:null);nt=J.r,et=J.g,rt=J.b,at=T.barchartcol;try{for(B in i={},w=[],N=0,Z.forEachRecord(t,T.derivedAttributes,function(t){var n,e,r,a;if(T.filter(t)){for(n in w.push(t),t)it.call(t,n)&&null==i[n]&&(i[n]={},0<N&&(i[n].null=N));for(n in i)a=null!=(r=t[n])?r:"null",null==(e=i[n])[a]&&(e[a]=0),i[n][a]++;return N++}}),q=Q("<table>",{class:"pvtUi"}).attr("cellpadding",5),O=Q("<td>"),D=Q("<select>").addClass("pvtRenderer").appendTo(O).bind("change",function(){if("function"==typeof T.rendererChanged){var t=D.val();j&&t in j&&(t=j[t]),T.rendererChanged(t)}return I()}),F=T.renderers)if(it.call(F,B)){var X=B;j&&X in j&&(X=j[X]),Q("<option>").val(B).html(X).appendTo(D)}if(H=Q("<td>").addClass("pvtAxisContainer pvtUnused"),U=function(){var t;for(a in t=[],i)ot.call(T.hiddenAttributes,a)<0&&t.push(a);return t}(),P=!1,K="auto"===T.unusedAttrsVertical?120:parseInt(T.unusedAttrsVertical),!isNaN(K)){for(h=o=0,p=U.length;h<p;h++)o+=(a=U[h]).length;P=K<o}for(v in!0===T.unusedAttrsVertical||P?H.addClass("pvtVertList"):H.addClass("pvtHorizList"),c=function(t){var n;var e=-1<Q.inArray(t,T.hides),r=Q("<li>");n=!1===e?r.addClass("axis_"+v).append(Q("<span>").addClass("pvtAttr").text(t).data("attrName",t)):Q("<li>").addClass("hidden axis_"+v).append(Q("<span>").addClass("pvtAttr").text(t).data("attrName",t));var a=-1<Q.inArray(t,T.nodropX),o=-1<Q.inArray(t,T.nodropY);return a&&r.addClass("nodropX"),o&&r.addClass("nodropY"),H.append(n).append(void 0)},U)it.call(U,v)&&c(m=U[v]);for(B in k=Q("<tr>").appendTo(q),d=Q("<select>").addClass("pvtAggregator").bind("change",function(){return I()}),R=T.aggregators)it.call(R,B)&&d.append(Q("<option>").val(B).html(B));for(Q("<td>").addClass("pvtVals").appendTo(k).append(d).append(Q("<br>")),Q("<td>").addClass("pvtAxisContainer pvtHorizList pvtCols").appendTo(k),(V=Q("<tr>").appendTo(q)).append(Q("<td>").addClass("pvtAxisContainer pvtRows").attr("valign","top")),x=Q("<td>").attr("valign","top").addClass("pvtRendererArea").appendTo(V),!0===T.unusedAttrsVertical||P?(q.find("tr:nth-child(1)").prepend(O),q.find("tr:nth-child(2)").prepend(H)):q.prepend(Q("<tr>").append(O).append(H)),this.html(q),M=T.cols,y=0,f=M.length;y<f;y++)B=M[y],this.find(".pvtCols").append(this.find(".axis_"+Q.inArray(B,U)));for(E=T.rows,S=0,C=E.length;S<C;S++)B=E[S],this.find(".pvtRows").append(this.find(".axis_"+Q.inArray(B,U)));if(null!=T.aggregatorName){var z=T.aggregatorName;W&&z in W&&(z=W[z]),this.find(".pvtAggregator").val(z)}null!=T.rendererName&&this.find(".pvtRenderer").val(T.rendererName),g=!0,_=this,L=function(){var o,n,t,e,r,a,i,s,l,u,c,h,p,f;if(h={derivedAttributes:T.derivedAttributes,localeStrings:T.localeStrings,rendererOptions:T.rendererOptions,sorters:T.sorters,cols:[],rows:[],dataClass:T.dataClass},r=null!=(l=T.aggregators[d.val()]([])().numInputs)?l:0,f=[],_.find(".pvtRows li span.pvtAttr").each(function(){return h.rows.push(Q(this).data("attrName"))}),_.find(".pvtCols li span.pvtAttr").each(function(){return h.cols.push(Q(this).data("attrName"))}),_.find(".pvtVals select.pvtAttrDropdown").each(function(){return 0===r?Q(this).remove():(r--,""!==Q(this).val()?f.push(Q(this).val()):void 0)}),0!==r)for(i=_.find(".pvtVals"),B=s=0,u=r;0<=u?s<u:u<s;B=0<=u?++s:--s){for(e=Q("<select>").addClass("pvtAttrDropdown").append(Q("<option>")).bind("change",function(){return I()}),c=0,t=U.length;c<t;c++)m=U[c],e.append(Q("<option>").val(m).text(m));i.append(e)}if(g&&(f=T.vals,v=0,_.find(".pvtVals select.pvtAttrDropdown").each(function(){return Q(this).val(f[v]),v++}),g=!1),h.aggregatorName=d.val(),h.vals=f,h.aggregator=T.aggregators[d.val()](f),h.renderer=T.renderers[D.val()],o={},_.find("input.pvtFilter").not(":checked").each(function(){var t;return t=Q(this).data("filter"),null!=o[t[0]]?o[t[0]].push(t[1]):o[t[0]]=[t[1]]}),n={},_.find("input.pvtFilter:checked").each(function(){var t;if(t=Q(this).data("filter"),null!=o[t[0]])return null!=n[t[0]]?n[t[0]].push(t[1]):n[t[0]]=[t[1]]}),h.filter=function(t){var n,e,r,a;if(!T.filter(t))return!1;for(e in o)if(n=o[e],r=""+(null!=(a=t[e])?a:"null"),0<=ot.call(n,r))return!1;return!0},x.pivot(w,h),a=Q.extend({},T,{cols:h.cols,rows:h.rows,vals:f,exclusions:o,inclusions:n,inclusionsInfo:n,aggregatorName:d.val(),rendererName:D.val()}),_.data("pivotUIOptions",a),T.autoSortUnusedAttrs&&(p=_.find("td.pvtUnused.pvtAxisContainer"),Q(p).children("li").sort(function(t,n){return tt(Q(t).text(),Q(n).text())}).appendTo(p)),x.css("opacity",1),null!=T.onRefresh)return T.onRefresh(a)},(I=function(){return x.css("opacity",.5),setTimeout(L,10)})(),this.find(".pvtAxisContainer.pvtUnused").sortable({update:function(t,n){if(null==n.sender)return I()},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder"}),this.find(".pvtAxisContainer.pvtCols").sortable({update:function(t,n){if(null==n.sender)return I()},receive:function(t,n){n.item.hasClass("nodropX")&&n.sender.sortable("cancel")},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder"}),this.find(".pvtAxisContainer.pvtRows").sortable({update:function(t,n){if(null==n.sender)return I()},receive:function(t,n){n.item.hasClass("nodropY")&&n.sender.sortable("cancel")},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder"})}catch(t){l=t,"undefined"!=typeof console&&null!==console&&console.error(l.stack),this.html(T.localeStrings.uiRenderError)}return this},Q.fn.heatmap=function(t,n){var o,e,r,a,i,s,l,u,c,h,p;null==t&&(t="heatmap"),u=this.data("numrows"),l=this.data("numcols"),o=function(t,o,i){return function(){switch(t){case"red":return function(t){return"ff"+t+t};case"green":return function(t){return t+"ff"+t};case"blue":return function(t){return""+t+t+"ff"}}}(),function(t,n,e,r){intensity=(100-Math.round(100*(r-o)/(i-o)))/100;var a=1-intensity;return"rgb("+Math.round(255*(a*(t/255)+1*intensity))+","+Math.round(255*(a*(n/255)+1*intensity))+","+Math.round(255*(a*(e/255)+1*intensity))+")"}},p=this,e=function(t,n){var e,r,a;return a=[],(r=function(n){return p.find(t).each(function(){var t;if(null!=(t=Q(this).data("value"))&&isFinite(t))return n(t,Q(this))})})(function(t){return a.push(t)}),e=o(n,Math.min.apply(Math,a),Math.max.apply(Math,a)),r(function(t,n){return n.css("background-color",e(nt,et,rt,t))})};var f="red";switch(255==et&&(f="green"),255==rt&&(f="green"),t){case"heatmap":e(".pvtVal",f);break;case"rowheatmap":for(r=i=0,c=u;0<=c?i<c:c<i;r=0<=c?++i:--i)e(".pvtVal.row"+r,f);break;case"colheatmap":for(a=s=0,h=l;0<=h?s<h:h<s;a=0<=h?++s:--s)e(".pvtVal.col"+a,f)}return e(".pvtTotal.rowTotal",f),e(".pvtTotal.colTotal",f),this},Q.fn.barchart=function(){var t,n,e,r,a;for(r=this.data("numrows"),this.data("numcols"),t=function(o){return function(t){var n,e,a,r;return r=[],(n=function(n){return o.find(t).each(function(){var t;if(null!=(t=Q(this).data("value"))&&isFinite(t))return n(t,Q(this))})})(function(t){return r.push(t)}),e=Math.max.apply(Math,r),a=function(t){return 100*t/(1.4*e)},n(function(t,n){var e,r;return e=n.text(),(r=Q("<div>").css({position:"relative",height:"55px"})).append(Q("<div>").css({position:"absolute",bottom:0,left:0,right:0,height:a(t)+"%","background-color":at})),r.append(Q("<div>").text(e).css({position:"relative","padding-left":"5px","padding-right":"5px"})),n.css({padding:0,"padding-top":"5px","text-align":"center"}).html(r)})}}(this),n=e=0,a=r;0<=a?e<a:a<e;n=0<=a?++e:--e)t(".pvtVal.row"+n);return t(".pvtTotal.colTotal"),this}})}).call(this);