function hasClass(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function addClass(e,t){e.classList?e.classList.add(t):hasClass(e,t)||(e.className+=" "+t)}function removeClass(e,t){if(e.classList)e.classList.remove(t);else if(hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}}function KeepAlive(){var e=new XMLHttpRequest,t=Math.round(1e6*Math.random());e.open("HEAD","donotdelete.conn?rand="+t,!0),e.onload=function(t){if(4===e.readyState&&e.status>=200&&e.status<304)try{b4j_ws.readyState}catch(e){}},e.onerror=function(e){},e.send(null)}function GetIsReconnect(){return IsReconnect}function b4j_sendData(e){b4j_ws&&b4j_ws.send(JSON.stringify({type:"data",data:e}))}function b4j_raiseEvent(e,t){if(b4j_ws){var n=document.getElementById("pageconnectedindicator");try{if(1!==b4j_ws.readyState){if(!1===b4j_closeMessage&&("undefined"==typeof RobustWebSocket?window.console.error("Server is currently not available."):window.console.error("Connection is closed. Trying to reconnect."),b4j_closeMessage=!0),null===n){o=Math.round(1e6*Math.random());RunToastNoConnection(o)}}else b4j_closeMessage=!1,b4j_ws.send(JSON.stringify({type:"event",event:e,params:t}))}catch(e){if(window.console.error(e),null===n){var o=Math.round(1e6*Math.random());window.console.log("no connection error"),RunToastNoConnection(o)}}}}function b4j_addEvent(e,t,n,o){var a=$(e);a.length>0&&a.on(t,function(t){o&&(t.preventDefault(),t.stopPropagation()),t.target.id?b4j_raiseEvent(n,{which:t.which,target:t.target.id,pageX:t.pageX,pageY:t.pageY,metaKey:t.metaKey}):b4j_raiseEvent(n,{which:t.which,target:e,pageX:t.pageX,pageY:t.pageY,metaKey:t.metaKey})})}function b4j_addAutomaticEvents(e){$.each(e,function(e,t){b4j_addEvent("#"+t.id,t.event,t.id+"_"+t.event,!0)})}function b4j_runFunction(e,t){return"function"==typeof window[e]?window[e].apply(null,t):(console.log(e),null)}function b4j_eval(e,t){return new Function(t).apply(null,e)}function b4j_connect(e){if("undefined"!=typeof WebSocket){var t,n=window.location;t=0!=n.port?("https:"===n.protocol?"wss://":"ws://")+n.hostname+":"+n.port+e+n.search:("https:"===n.protocol?"wss://":"ws://")+n.hostname+e+n.search,"undefined"==typeof RobustWebSocket?(console.log("Using normal WebSocket"),WebSocketType="normal",b4j_ws=new WebSocket(t)):(console.log("Using RobustWebSocket"),WebSocketType="robust",b4j_ws=new RobustWebSocket(t)),b4j_ws.addEventListener("message",function(e){var t=JSON.parse(e.data);"runmethod"===t.etype?$(t.id)[t.method].apply($(t.id),t.params):"runmethodWithResult"===t.etype?b4j_sendData($(t.id)[t.method].apply($(t.id),t.params)):"setAutomaticEvents"===t.etype?b4j_addAutomaticEvents(t.data):"runFunction"===t.etype?b4j_runFunction(t.prop,t.value):"runFunctionWithResult"===t.etype?b4j_sendData(b4j_runFunction(t.prop,t.value)):"eval"===t.etype?b4j_eval(t.value,t.prop):"evalWithResult"===t.etype?b4j_sendData(b4j_eval(t.value,t.prop)):"alert"===t.etype&&window.alert(t.prop)}),b4j_ws.addEventListener("open",function(e){console.log("WebSocket opened, reconnected?: "+IsReconnect),reconnectTimeout&&clearInterval(reconnectTimeout);var t=document.body,n=document.getElementById("isloaderwrapper");if(n&&!hasClass(n,"isloading")&&!hasClass(t,"loaded")){addClass(t,"loaded");var o=document.getElementById("loader-wrapper");o&&o.parentElement.removeChild(o)}var a=document.getElementById("pageconnectedindicator");a&&(removeClass(a,"indicatorinactive"),addClass(a,"indicatoractive"))}),b4j_ws.addEventListener("close",function(e){IsReconnect=!0,console.log("closed - navigator.onLine:"+navigator.onLine),reconnectTimeout&&clearInterval(reconnectTimeout);var t=document.getElementById("pageconnectedindicator");t&&(removeClass(t,"indicatoractive"),addClass(t,"indicatorinactive")),navigator.onLine||(reconnectTimeout=setInterval(function(){navigator.onLine&&(clearInterval(reconnectTimeout),"robust"==WebSocketType&&b4j_ws.startReconnect(e))},1e3))});var o=isOnIOS?"pagehide":"beforeunload";window.addEventListener(o,function(e){b4j_raiseEvent("page_parseevent",{eventname:"beforeunload",eventparams:""})})}else window.alert("WebSockets are not supported by your browser.")}var hasEvents=!1;"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(void 0!==o&&null!==o)for(var a in o)o.hasOwnProperty(a)&&(t[a]=o[a])}return t}),function(e){function t(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n;return"undefined"!=typeof document?(n=document.createEvent("CustomEvent")).initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n={type:e,detail:t.detail,bubbles:!1,cancelable:!1,preventDefault:function(){},stopPropagation:function(){}},n}"function"!=typeof e.CustomEvent&&(e.Event&&(t.prototype=e.Event.prototype),e.CustomEvent=t)}(this),function(e,t){"function"==typeof define&&define.amd?define(function(){return e(t,navigator)}):"object"==typeof exports&&"object"==typeof module?module.exports=e(t,navigator):t.RobustWebSocket=e(t,"undefined"!=typeof Mocha?Mocha:navigator)}(function(e,t){var n=function(o,a,i){function s(){p&&(p=null,clearTimeout(p))}function c(){j&&(e.removeEventListener("online",w),e.removeEventListener("offline",E),j=!1,hasEvents=!1)}function r(){j||(e.addEventListener("online",w),e.addEventListener("offline",E),j=!0,hasEvents=!0)}function u(e){if(1e3===e.code||y){if(console.log("Stop reconnecting: "+e.code+","+y),m=0,IsReconnect=!0,null===document.getElementById("pageconnectedindicator")){var n=Math.round(1e6*Math.random());RunToastNoConnection(n)}}else{if(!1===t.onLine)return void(h=!0);var o=g.shouldReconnect(e,v);"number"==typeof o&&(p=setTimeout(l,o))}}function l(){p=null,f=new WebSocket(o),m++,v.dispatchEvent(Object.assign(new CustomEvent("connecting"),{attempts:m,reconnects:b})),d=setTimeout(function(){d=null,c(),v.dispatchEvent(Object.assign(new CustomEvent("timeout"),{attempts:m,reconnects:b}))},g.timeout),["open","close","message","error"].forEach(function(e){f.addEventListener(e,function(t){v.dispatchEvent(t);var n=v["on"+e];if("function"==typeof n)return n.apply(v,arguments)})}),r()}var d,p,f={close:function(){}},v=this,m=0,b=-1,h=!1,y=!1,g=Object.assign({},n.defaultOptions,"function"==typeof i?{shouldReconnect:i}:i);if("number"!=typeof g.timeout)throw new Error("timeout must be the number of milliseconds to timeout a connection attempt");if("function"!=typeof g.shouldReconnect)throw new Error("shouldReconnect must be a function that returns the number of milliseconds to wait for a reconnect attempt, or null or undefined to not reconnect.");["bufferedAmount","url","readyState","protocol","extensions"].forEach(function(e){Object.defineProperty(v,e,{get:function(){return f[e]}})});var w=function(e){h&&(s(),u(e))},E=function(){h=!0,f.close(1e3)},j=!1;v.send=function(){return f.send.apply(f,arguments)},v.close=function(e,t){return"number"!=typeof e&&(t=e,e=1e3),s(),h=!1,y=!0,c(),f.close(e,t)},v.open=function(){f.readyState!==WebSocket.OPEN&&f.readyState!==WebSocket.CONNECTING&&(s(),h=!1,y=!1,l())},v.startReconnect=function(e){IsReconnect=!0,h&&(s(),u(e))},Object.defineProperty(v,"listeners",{value:{open:[function(e){d&&(clearTimeout(d),d=null),e.reconnects=++b,e.attempts=m,m=0,h=!1}],close:[u]}}),Object.defineProperty(v,"attempts",{get:function(){return m},enumerable:!0}),Object.defineProperty(v,"reconnects",{get:function(){return b},enumerable:!0}),g.automaticOpen&&l()};return n.defaultOptions={timeout:1e3,shouldReconnect:function(e,t){return"online"===e.type?0:1008!==e.code&&1011!==e.code?1e3:void 0},automaticOpen:!0},n.prototype.addEventListener=function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)},n.prototype.removeEventListener=function(e,t){if(e in this.listeners)for(var n=this.listeners[e],o=0,a=n.length;o<a;o++)if(n[o]===t)return void n.splice(o,1)},n.prototype.dispatchEvent=function(e){if(e.type in this.listeners){e.currentTarget=this;for(var t=this.listeners[e.type],n=0,o=t.length;n<o;n++)t[n].call(this,e)}},n},this);var IsReconnect=!1,b4j_ws,b4j_closeMessage=!1,isOnIOS=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),WebSocketType,mySessionId="",reconnectTimeout;