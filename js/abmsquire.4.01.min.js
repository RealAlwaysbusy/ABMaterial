function getDocHeight(doc) {
    doc = doc || document;
    // stackoverflow.com/questions/1145850/
    var body = doc.body, html = doc.documentElement;
    var height = Math.max( body.scrollHeight, body.offsetHeight, 
        html.clientHeight, html.scrollHeight, html.offsetHeight );
    return height;
}

function resizeFrame(t) {
    if (t) {
        var e = $(window).scrollTop();
		/*
        "true" == t.getAttribute("abmenabled") ? $(t).contents().find("body").css("margin", "8px") : $(t).contents().find("body").css("margin", "0px"), t.style.height = "auto", t.contentDocument && (t.style.height = t.contentDocument.documentElement.scrollHeight + 15 + "px"), t.contentWindow && (t.style.height = t.contentWindow.document.body.scrollHeight + 15 + "px"), $(window).scrollTop(e)
		*/
		if (t.getAttribute("abmenabled") == "true") {
			$(t).contents().find("body").css("margin", "8px");
		} else {
			$(t).contents().find("body").css("margin", "0px")
		}
		var id = t;
		var ifrm = $(id)[0];
		var doc = ifrm.contentDocument? ifrm.contentDocument: 
        ifrm.contentWindow.document;
		ifrm.style.visibility = 'hidden';
		ifrm.style.height = "10px"; // reset to minimal height ...
		// IE opt. for bing/msn needs a bit added or scrollbar appears
		ifrm.style.height = getDocHeight( doc ) + 4 + "px";
		ifrm.style.visibility = 'visible';
		$(window).scrollTop(e);
    }
}!function(t,e){"use strict";function n(t,e,n){this.root=this.currentNode=t,this.nodeType=e,this.filter=n}function i(t,e){for(var n=t.length;n--;)if(!e(t[n]))return!1;return!0}function o(t){return t.nodeType===$&&!!ot[t.nodeName]}function r(t){return it.test(t.nodeName)}function s(t){var e=t.nodeType;return(e===$||e===I)&&!r(t)&&i(t.childNodes,r)}function a(t){var e=t.nodeType;return!(e!==$&&e!==I||r(t)||s(t))}function l(t,e){var i=new n(e,R,s);return i.currentNode=t,i}function d(t,e){return t=l(t,e).previousNode(),t!==e?t:null}function h(t,e){return t=l(t,e).nextNode(),t!==e?t:null}function c(t,e){return!o(t)&&t.nodeType===e.nodeType&&t.nodeName===e.nodeName&&"A"!==t.nodeName&&t.className===e.className&&(!t.style&&!e.style||t.style.cssText===e.style.cssText)}function f(t,e,n){if(t.nodeName!==e)return!1;for(var i in n)if(t.getAttribute(i)!==n[i])return!1;return!0}function u(t,e,n,i){for(;t&&t!==e;){if(f(t,n,i))return t;t=t.parentNode}return null}function p(t,e){for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function g(t,e){var n,i,o,r,s="";return t&&t!==e&&(s=g(t.parentNode,e),t.nodeType===$&&(s+=(s?">":"")+t.nodeName,(n=t.id)&&(s+="#"+n),(i=t.className.trim())&&((o=i.split(/\s\s*/)).sort(),s+=".",s+=o.join(".")),(r=t.dir)&&(s+="[dir="+r+"]"))),s}function m(t){return t.nodeType===$?t.childNodes.length:t.length||0}function v(t){var e=t.parentNode;return e&&e.removeChild(t),t}function b(t,e){var n=t.parentNode;n&&n.replaceChild(e,t)}function C(t){for(var e=t.ownerDocument.createDocumentFragment(),n=t.childNodes,i=n?n.length:0;i--;)e.appendChild(t.firstChild);return e}function y(t,n,i,o){var r,s,a,l=t.createElement(n);if(i instanceof Array&&(o=i,i=null),i)for(r in i)i[r]!==e&&l.setAttribute(r,i[r]);if(o)for(s=0,a=o.length;s<a;s+=1)l.appendChild(o[s]);return l}function S(t,e){var n,i,s=t.ownerDocument,a=t;if(t===e&&((i=t.firstChild)&&"BR"!==i.nodeName||(n=E(s).createDefaultBlock(),i?t.replaceChild(n,i):t.appendChild(n),t=n,n=null)),t.nodeType===D)return a;if(r(t)){for(i=t.firstChild;G&&i&&i.nodeType===D&&!i.data;)t.removeChild(i),i=t.firstChild;i||(G?(n=s.createTextNode(F),E(s)._didAddZWS()):n=s.createTextNode(""))}else if(V){for(;t.nodeType!==D&&!o(t);){if(!(i=t.firstChild)){n=s.createTextNode("");break}t=i}t.nodeType===D?/^ +$/.test(t.data)&&(t.data=""):o(t)&&t.parentNode.insertBefore(s.createTextNode(""),t)}else if(!t.querySelector("BR"))for(n=y(s,"BR");(i=t.lastElementChild)&&!r(i);)t=i;if(n)try{t.appendChild(n)}catch(e){E(s).didError({name:"Squire: fixCursor – "+e,message:"Parent: "+t.nodeName+"/"+t.innerHTML+" appendChild: "+n.nodeName})}return a}function _(t,e){var n,i,o,s,l=t.childNodes,d=t.ownerDocument,h=null,c=E(d)._config;for(n=0,i=l.length;n<i;n+=1)!(s="BR"===(o=l[n]).nodeName)&&r(o)?(h||(h=y(d,c.blockTag,c.blockAttributes)),h.appendChild(o),n-=1,i-=1):(s||h)&&(h||(h=y(d,c.blockTag,c.blockAttributes)),S(h,e),s?t.replaceChild(h,o):(t.insertBefore(h,o),n+=1,i+=1),h=null),a(o)&&_(o,e);return h&&t.appendChild(S(h,e)),t}function x(t,e,n,i){var o,r,s,a=t.nodeType;if(a===D&&t!==n)return x(t.parentNode,t.splitText(e),n,i);if(a===$){if("number"==typeof e&&(e=e<t.childNodes.length?t.childNodes[e]:null),t===n)return e;for(o=t.parentNode,r=t.cloneNode(!1);e;)s=e.nextSibling,r.appendChild(e),e=s;return"OL"===t.nodeName&&u(t,i,"BLOCKQUOTE")&&(r.start=(+t.start||1)+t.childNodes.length-1),S(t,i),S(r,i),(s=t.nextSibling)?o.insertBefore(r,s):o.appendChild(r),x(o,r,n,i)}return e}function N(t,e){if(t.nodeType===$)for(var n,i,o,s=t.childNodes,a=s.length,l=[];a--;)if(n=s[a],i=a&&s[a-1],a&&r(n)&&c(n,i)&&!ot[n.nodeName])e.startContainer===n&&(e.startContainer=i,e.startOffset+=m(i)),e.endContainer===n&&(e.endContainer=i,e.endOffset+=m(i)),e.startContainer===t&&(e.startOffset>a?e.startOffset-=1:e.startOffset===a&&(e.startContainer=i,e.startOffset=m(i))),e.endContainer===t&&(e.endOffset>a?e.endOffset-=1:e.endOffset===a&&(e.endContainer=i,e.endOffset=m(i))),v(n),n.nodeType===D?i.appendData(n.data):l.push(C(n));else if(n.nodeType===$){for(o=l.length;o--;)n.appendChild(l.pop());N(n,e)}}function T(t,e,n){for(var i,o,r,s=e;1===s.parentNode.childNodes.length;)s=s.parentNode;v(s),o=t.childNodes.length,(i=t.lastChild)&&"BR"===i.nodeName&&(t.removeChild(i),o-=1),r={startContainer:t,startOffset:o,endContainer:t,endOffset:o},t.appendChild(C(e)),N(t,r),n.setStart(r.startContainer,r.startOffset),n.collapse(!0),Q&&(i=t.lastChild)&&"BR"===i.nodeName&&t.removeChild(i)}function k(t,e){var n,i,o=t.previousSibling,r=t.firstChild,s=t.ownerDocument,l="LI"===t.nodeName;if(!l||r&&/^[OU]L$/.test(r.nodeName))if(o&&c(o,t)){if(!a(o)){if(!l)return;(i=y(s,"DIV")).appendChild(C(o)),o.appendChild(i)}v(t),n=!a(t),o.appendChild(C(t)),n&&_(o,e),r&&k(r,e)}else l&&(o=y(s,"DIV"),t.insertBefore(o,r),S(o,e))}function E(t){for(var e,n=zt.length;n--;)if((e=zt[n])._doc===t)return e;return null}function O(t,e){var n,i;t||(t={});for(n in e)i=e[n],t[n]=i&&i.constructor===Object?O(t[n],i):i;return t}function w(t,e){t.nodeType===U&&(t=t.body);var n,i=t.ownerDocument,o=i.defaultView;this._win=o,this._doc=i,this._root=t,this._events={},this._lastSelection=null,X&&this.addEventListener("beforedeactivate",this.getSelection),this._hasZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="","onselectionchange"in i?this.addEventListener("selectionchange",this._updatePathOnEvent):(this.addEventListener("keyup",this._updatePathOnEvent),this.addEventListener("mouseup",this._updatePathOnEvent)),this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0,this._isInUndoState=!1,this._ignoreChange=!1,this._ignoreAllChanges=!1,J?((n=new MutationObserver(this._docWasChanged.bind(this))).observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._mutation=n):this.addEventListener("keyup",this._keyUpDetectChange),this._restoreSelection=!1,this.addEventListener("blur",L),this.addEventListener("input",B),this.addEventListener("mousedown",B),this.addEventListener("touchstart",B),this.addEventListener("focus",A),this._awaitingPaste=!1,this.addEventListener(j?"beforecut":"cut",Rt),this.addEventListener("copy",Ft),this.addEventListener(j?"beforepaste":"paste",Mt),this.addEventListener("drop",Wt),this.addEventListener(Q?"keypress":"keydown",St),this._keyHandlers=Object.create(Tt),this.setConfig(e),j&&(o.Text.prototype.splitText=function(t){var e=this.ownerDocument.createTextNode(this.data.slice(t)),n=this.nextSibling,i=this.parentNode,o=this.length-t;return n?i.insertBefore(e,n):i.appendChild(e),o&&this.deleteData(t,o),e}),t.setAttribute("contenteditable","true");try{i.execCommand("enableObjectResizing",!1,"false"),i.execCommand("enableInlineTableEditing",!1,"false")}catch(t){}zt.push(this),this.setHTML("")}function L(){this._restoreSelection=!0}function B(){this._restoreSelection=!1}function A(){this._restoreSelection&&this.setSelection(this._lastSelection)}function P(t,e,n){var i,o;for(i=e.firstChild;i;i=o){if(o=i.nextSibling,r(i)){if(i.nodeType===D||"BR"===i.nodeName||"IMG"===i.nodeName){n.appendChild(i);continue}}else if(s(i)){n.appendChild(t.createDefaultBlock([P(t,i,t._doc.createDocumentFragment())]));continue}P(t,i,n)}return n}var $=1,D=3,U=9,I=11,R=1,F="​",M=t.defaultView,W=navigator.userAgent,z=/iP(?:ad|hone|od)/.test(W),H=/Mac OS X/.test(W),q=/Gecko\//.test(W),j=/Trident\/[456]\./.test(W),Q=!!M.opera,Y=/Edge\//.test(W),Z=!Y&&/WebKit\//.test(W),K=H?"meta-":"ctrl-",V=j||Q,G=j||Z,X=j,J="undefined"!=typeof MutationObserver,tt=/[^ \t\r\n]/,et=Array.prototype.indexOf;Object.create||(Object.create=function(t){var e=function(){};return e.prototype=t,new e});var nt={1:1,2:2,3:4,8:128,9:256,11:1024};n.prototype.nextNode=function(){for(var t,e=this.currentNode,n=this.root,i=this.nodeType,o=this.filter;;){for(t=e.firstChild;!t&&e&&e!==n;)(t=e.nextSibling)||(e=e.parentNode);if(!t)return null;if(nt[t.nodeType]&i&&o(t))return this.currentNode=t,t;e=t}},n.prototype.previousNode=function(){for(var t,e=this.currentNode,n=this.root,i=this.nodeType,o=this.filter;;){if(e===n)return null;if(t=e.previousSibling)for(;e=t.lastChild;)t=e;else t=e.parentNode;if(!t)return null;if(nt[t.nodeType]&i&&o(t))return this.currentNode=t,t;e=t}},n.prototype.previousPONode=function(){for(var t,e=this.currentNode,n=this.root,i=this.nodeType,o=this.filter;;){for(t=e.lastChild;!t&&e&&e!==n;)(t=e.previousSibling)||(e=e.parentNode);if(!t)return null;if(nt[t.nodeType]&i&&o(t))return this.currentNode=t,t;e=t}};var it=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:FRAME|MG|NPUT|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|U|VAR|WBR)$/,ot={BR:1,HR:1,IFRAME:1,IMG:1,INPUT:1},rt=function(t,e){for(var n=t.childNodes;e&&t.nodeType===$;)e=(n=(t=n[e-1]).childNodes).length;return t},st=function(t,e){if(t.nodeType===$){var n=t.childNodes;if(e<n.length)t=n[e];else{for(;t&&!t.nextSibling;)t=t.parentNode;t&&(t=t.nextSibling)}}return t},at=function(t,e){var n,i,o,r,s=t.startContainer,a=t.startOffset,l=t.endContainer,d=t.endOffset;s.nodeType===D?(i=(n=s.parentNode).childNodes,a===s.length?(a=et.call(i,s)+1,t.collapsed&&(l=n,d=a)):(a&&(r=s.splitText(a),l===s?(d-=a,l=r):l===n&&(d+=1),s=r),a=et.call(i,s)),s=n):i=s.childNodes,a===(o=i.length)?s.appendChild(e):s.insertBefore(e,i[a]),s===l&&(d+=i.length-o),t.setStart(s,a),t.setEnd(l,d)},lt=function(t,e,n){var i=t.startContainer,o=t.startOffset,r=t.endContainer,s=t.endOffset;e||(e=t.commonAncestorContainer),e.nodeType===D&&(e=e.parentNode);for(var a,l,d,h=x(r,s,e,n),c=x(i,o,e,n),f=e.ownerDocument.createDocumentFragment();c!==h;)a=c.nextSibling,f.appendChild(c),c=a;return i=e,o=h?et.call(e.childNodes,h):e.childNodes.length,d=e.childNodes[o],(l=d&&d.previousSibling)&&l.nodeType===D&&d.nodeType===D&&(i=l,o=l.length,l.appendData(d.data),v(d)),t.setStart(i,o),t.collapse(!0),S(e,n),f},dt=function(t,e){ut(t);var n=t.startContainer,i=t.endContainer,o=(r(n)||s(n))&&(r(i)||s(i)),a=lt(t,null,e);ft(t),n=pt(t,e),o&&(i=gt(t,e),n&&i&&n!==i&&T(n,i,t)),n&&S(n,e);var l=e.firstChild;return l&&"BR"!==l.nodeName?t.collapse(!1):(S(e,e),t.selectNodeContents(e.firstChild)),a},ht=function(t,e,n){for(var i=!0,o=e.childNodes,l=o.length;l--;)if(!r(o[l])){i=!1;break}if(t.collapsed||dt(t,n),ft(t),i)at(t,e),t.collapse(!1);else{for(var c,f,p,g,m,v=t.startContainer,b=x(v,t.startOffset,u(v.parentNode,n,"BLOCKQUOTE")||n,n),C=b.previousSibling,y=C,_=y.childNodes.length,N=b,T=0,E=b.parentNode;(c=y.lastChild)&&c.nodeType===$;){if("BR"===c.nodeName){_-=1;break}_=(y=c).childNodes.length}for(;(c=N.firstChild)&&c.nodeType===$&&"BR"!==c.nodeName;)N=c;for(m=y.childNodes[_]||null;(c=e.firstChild)&&r(c);)y.insertBefore(c,m);for(;(c=e.lastChild)&&r(c);)N.insertBefore(c,N.firstChild),T+=1;for(f=e;f=h(f,n);)S(f,n);if(E.insertBefore(e,b),g=C.nextSibling,(f=d(g,n))&&!/\S/.test(f.textContent))do{(E=f.parentNode).removeChild(f),f=E}while(f&&!f.lastChild&&f!==n);if(C.parentNode||(C=g.previousSibling),y.parentNode||(y=C||g.parentNode,_=C?C.childNodes.length:0),a(g)&&k(g,n),p=b.previousSibling,(f=s(b)?b:h(b,n))&&!/\S/.test(f.textContent))do{(E=f.parentNode).removeChild(f),f=E}while(f&&!f.lastChild&&f!==n);b.parentNode||(b=p.nextSibling),T||(N=p,T=p.childNodes.length),b&&a(b)&&k(b,n),t.setStart(y,_),t.setEnd(N,T),ft(t)}},ct=function(t,e,n){var i=e.ownerDocument.createRange();if(i.selectNode(e),n){var o=t.compareBoundaryPoints(3,i)>-1,r=t.compareBoundaryPoints(1,i)<1;return!o&&!r}var s=t.compareBoundaryPoints(0,i)<1,a=t.compareBoundaryPoints(2,i)>-1;return s&&a},ft=function(t){for(var e,n=t.startContainer,i=t.startOffset,r=t.endContainer,s=t.endOffset;n.nodeType!==D&&(e=n.childNodes[i])&&!o(e);)n=e,i=0;if(s)for(;r.nodeType!==D&&(e=r.childNodes[s-1])&&!o(e);)s=m(r=e);else for(;r.nodeType!==D&&(e=r.firstChild)&&!o(e);)r=e;t.collapsed?(t.setStart(r,s),t.setEnd(n,i)):(t.setStart(n,i),t.setEnd(r,s))},ut=function(t,e){var n,i=t.startContainer,o=t.startOffset,r=t.endContainer,s=t.endOffset;for(e||(e=t.commonAncestorContainer);i!==e&&!o;)n=i.parentNode,o=et.call(n.childNodes,i),i=n;for(;r!==e&&s===m(r);)n=r.parentNode,s=et.call(n.childNodes,r)+1,r=n;t.setStart(i,o),t.setEnd(r,s)},pt=function(t,e){var n,i=t.startContainer;return n=r(i)?d(i,e):s(i)?i:h(n=rt(i,t.startOffset),e),n&&ct(t,n,!0)?n:null},gt=function(t,e){var n,i,o=t.endContainer;if(r(o))n=d(o,e);else if(s(o))n=o;else{if(!(n=st(o,t.endOffset))||!p(e,n))for(n=e;i=n.lastChild;)n=i;n=d(n,e)}return n&&ct(t,n,!0)?n:null},mt=new n(null,4|R,function(t){return t.nodeType===D?tt.test(t.data):"IMG"===t.nodeName}),vt=function(t,e){var n,i=t.startContainer,o=t.startOffset;if(mt.root=null,i.nodeType===D){if(o)return!1;n=i}else if((n=st(i,o))&&!p(e,n)&&(n=null),!n&&(n=rt(i,o)).nodeType===D&&n.length)return!1;return mt.currentNode=n,mt.root=pt(t,e),!mt.previousNode()},bt=function(t,e){var n,i=t.endContainer,o=t.endOffset;if(mt.root=null,i.nodeType===D){if((n=i.data.length)&&o<n)return!1;mt.currentNode=i}else mt.currentNode=rt(i,o);return mt.root=gt(t,e),!mt.nextNode()},Ct=function(t,e){var n,i=pt(t,e),o=gt(t,e);i&&o&&(n=i.parentNode,t.setStart(n,et.call(n.childNodes,i)),n=o.parentNode,t.setEnd(n,et.call(n.childNodes,o)+1))},yt={8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",37:"left",39:"right",46:"delete",219:"[",221:"]"},St=function(t){var e=t.keyCode,n=yt[e],i="",o=this.getSelection();t.defaultPrevented||(n||(n=String.fromCharCode(e).toLowerCase(),/^[A-Za-z0-9]$/.test(n)||(n="")),Q&&46===t.which&&(n="."),111<e&&e<124&&(n="f"+(e-111)),"backspace"!==n&&"delete"!==n&&(t.altKey&&(i+="alt-"),t.ctrlKey&&(i+="ctrl-"),t.metaKey&&(i+="meta-")),t.shiftKey&&(i+="shift-"),n=i+n,this._keyHandlers[n]?this._keyHandlers[n](this,t,o):1!==n.length||o.collapsed||(this.saveUndoState(o),dt(o,this._root),this._ensureBottomLine(),this.setSelection(o),this._updatePath(o,!0)))},_t=function(t){return function(e,n){n.preventDefault(),e[t]()}},xt=function(t,e){return e=e||null,function(n,i){i.preventDefault();var o=n.getSelection();n.hasFormat(t,null,o)?n.changeFormat(null,{tag:t},o):n.changeFormat({tag:t},e,o)}},Nt=function(t,e){try{e||(e=t.getSelection());var n,i=e.startContainer;for(i.nodeType===D&&(i=i.parentNode),n=i;r(n)&&(!n.textContent||n.textContent===F);)n=(i=n).parentNode;i!==n&&(e.setStart(n,et.call(n.childNodes,i)),e.collapse(!0),n.removeChild(i),s(n)||(n=d(n,t._root)),S(n,t._root),ft(e)),i===t._root&&(i=i.firstChild)&&"BR"===i.nodeName&&v(i),t._ensureBottomLine(),t.setSelection(e),t._updatePath(e,!0)}catch(e){t.didError(e)}},Tt={enter:function(t,e,n){var i,o,r,s=t._root;if(e.preventDefault(),t._recordUndoState(n),ee(n.startContainer,s,t),t._removeZWS(),t._getRangeAndRemoveBookmark(n),n.collapsed||dt(n,s),!(i=pt(n,s))||/^T[HD]$/.test(i.nodeName))return at(n,t.createElement("BR")),n.collapse(!1),t.setSelection(n),void t._updatePath(n,!0);if((o=u(i,s,"LI"))&&(i=o),!i.textContent){if(u(i,s,"UL")||u(i,s,"OL"))return t.modifyBlocks(Jt,n);if(u(i,s,"BLOCKQUOTE"))return t.modifyBlocks(Vt,n)}for(r=Zt(t,i,n.startContainer,n.startOffset),Qt(i),$t(i),S(i,s);r.nodeType===$;){var a,l=r.firstChild;if("A"===r.nodeName&&(!r.textContent||r.textContent===F)){b(r,l=t._doc.createTextNode("")),r=l;break}for(;l&&l.nodeType===D&&!l.data&&(a=l.nextSibling)&&"BR"!==a.nodeName;)v(l),l=a;if(!l||"BR"===l.nodeName||l.nodeType===D&&!Q)break;r=l}n=t._createRange(r,0),t.setSelection(n),t._updatePath(n,!0)},backspace:function(t,e,n){var i=t._root;if(t._removeZWS(),t.saveUndoState(n),n.collapsed)if(vt(n,i)){e.preventDefault();var o,r=pt(n,i);if(!r)return;if(_(r.parentNode,i),o=d(r,i)){if(!o.isContentEditable)return void v(o);for(T(o,r,n),r=o.parentNode;r!==i&&!r.nextSibling;)r=r.parentNode;r!==i&&(r=r.nextSibling)&&k(r,i),t.setSelection(n)}else if(r){if(u(r,i,"UL")||u(r,i,"OL"))return t.modifyBlocks(Jt,n);if(u(r,i,"BLOCKQUOTE"))return t.modifyBlocks(Kt,n);t.setSelection(n),t._updatePath(n,!0)}}else t.setSelection(n),setTimeout(function(){Nt(t)},0);else e.preventDefault(),dt(n,i),Nt(t,n)},delete:function(t,e,n){var i,o,r,s,a,l,d=t._root;if(t._removeZWS(),t.saveUndoState(n),n.collapsed)if(bt(n,d)){if(e.preventDefault(),!(i=pt(n,d)))return;if(_(i.parentNode,d),o=h(i,d)){if(!o.isContentEditable)return void v(o);for(T(i,o,n),o=i.parentNode;o!==d&&!o.nextSibling;)o=o.parentNode;o!==d&&(o=o.nextSibling)&&k(o,d),t.setSelection(n),t._updatePath(n,!0)}}else{if(r=n.cloneRange(),ut(n,t._root),s=n.endContainer,a=n.endOffset,s.nodeType===$&&(l=s.childNodes[a])&&"IMG"===l.nodeName)return e.preventDefault(),v(l),ft(n),void Nt(t,n);t.setSelection(r),setTimeout(function(){Nt(t)},0)}else e.preventDefault(),dt(n,d),Nt(t,n)},tab:function(t,e,n){var i,o,r=t._root;if(t._removeZWS(),n.collapsed&&vt(n,r))for(i=pt(n,r);o=i.parentNode;){if("UL"===o.nodeName||"OL"===o.nodeName){i.previousSibling&&(e.preventDefault(),t.modifyBlocks(Xt,n));break}i=o}},"shift-tab":function(t,e,n){var i,o=t._root;t._removeZWS(),n.collapsed&&vt(n,o)&&(u(i=n.startContainer,o,"UL")||u(i,o,"OL"))&&(e.preventDefault(),t.modifyBlocks(Jt,n))},space:function(t,e,n){var i,o;t._recordUndoState(n),ee(n.startContainer,t._root,t),t._getRangeAndRemoveBookmark(n),o=(i=n.endContainer).parentNode,n.collapsed&&"A"===o.nodeName&&!i.nextSibling&&n.endOffset===m(i)&&n.setStartAfter(o),t.setSelection(n)},left:function(t){t._removeZWS()},right:function(t){t._removeZWS()}};H&&q&&(Tt["meta-left"]=function(t,e){e.preventDefault();var n=jt(t);n&&n.modify&&n.modify("move","backward","lineboundary")},Tt["meta-right"]=function(t,e){e.preventDefault();var n=jt(t);n&&n.modify&&n.modify("move","forward","lineboundary")}),H||(Tt.pageup=function(t){t.moveCursorToStart()},Tt.pagedown=function(t){t.moveCursorToEnd()}),Tt[K+"b"]=xt("B"),Tt[K+"i"]=xt("I"),Tt[K+"u"]=xt("U"),Tt[K+"shift-7"]=xt("S"),Tt[K+"shift-5"]=xt("SUB",{tag:"SUP"}),Tt[K+"shift-6"]=xt("SUP",{tag:"SUB"}),Tt[K+"shift-8"]=_t("makeUnorderedList"),Tt[K+"shift-9"]=_t("makeOrderedList"),Tt[K+"["]=_t("decreaseQuoteLevel"),Tt[K+"]"]=_t("increaseQuoteLevel"),Tt[K+"y"]=_t("redo"),Tt[K+"z"]=_t("undo"),Tt[K+"shift-z"]=_t("redo");var kt={1:10,2:13,3:16,4:18,5:24,6:32,7:48},Et={backgroundColor:{regexp:tt,replace:function(t,e){return y(t,"SPAN",{class:"highlight",style:"background-color:"+e})}},color:{regexp:tt,replace:function(t,e){return y(t,"SPAN",{class:"colour",style:"color:"+e})}},fontWeight:{regexp:/^bold/i,replace:function(t){return y(t,"B")}},fontStyle:{regexp:/^italic/i,replace:function(t){return y(t,"I")}},fontFamily:{regexp:tt,replace:function(t,e){return y(t,"SPAN",{class:"font",style:"font-family:"+e})}},fontSize:{regexp:tt,replace:function(t,e){return y(t,"SPAN",{class:"size",style:"font-size:"+e})}}},Ot=function(t){return function(e,n){var i=y(e.ownerDocument,t);return n.replaceChild(i,e),i.appendChild(C(e)),i}},wt={SPAN:function(t,e){var n,i,o,r,s,a,l=t.style,d=t.ownerDocument;for(n in Et)i=Et[n],(o=l[n])&&i.regexp.test(o)&&(a=i.replace(d,o),r&&r.appendChild(a),r=a,s||(s=a));return s&&(r.appendChild(C(t)),e.replaceChild(s,t)),r||t},STRONG:Ot("B"),EM:Ot("I"),STRIKE:Ot("S"),FONT:function(t,e){var n,i,o,r,s,a=t.face,l=t.size,d=t.color,h=t.ownerDocument;return a&&(s=n=y(h,"SPAN",{class:"font",style:"font-family:"+a}),r=n),l&&(i=y(h,"SPAN",{class:"size",style:"font-size:"+kt[l]+"px"}),s||(s=i),r&&r.appendChild(i),r=i),d&&/^#?([\dA-F]{3}){1,2}$/i.test(d)&&("#"!==d.charAt(0)&&(d="#"+d),o=y(h,"SPAN",{class:"colour",style:"color:"+d}),s||(s=o),r&&r.appendChild(o),r=o),s||(s=r=y(h,"SPAN")),e.replaceChild(s,t),r.appendChild(C(t)),r},TT:function(t,e){var n=y(t.ownerDocument,"SPAN",{class:"font",style:'font-family:menlo,consolas,"courier new",monospace'});return e.replaceChild(n,t),n.appendChild(C(t)),n}},Lt=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|UL)$/,Bt=/^(?:HEAD|META|STYLE)/,At=new n(null,4|R,function(){return!0}),Pt=function t(e,n){var i,o,s,a,l,d,h,c,f,u,p,g,m=e.childNodes;for(i=e;r(i);)i=i.parentNode;for(At.root=i,o=0,s=m.length;o<s;o+=1)if(a=m[o],l=a.nodeName,d=a.nodeType,h=wt[l],d===$){if(c=a.childNodes.length,h)a=h(a,e);else{if(Bt.test(l)){e.removeChild(a),o-=1,s-=1;continue}if(!Lt.test(l)&&!r(a)){o-=1,s+=c-1,e.replaceChild(C(a),a);continue}}c&&t(a,n||"PRE"===l)}else{if(d===D){if(p=a.data,f=!tt.test(p.charAt(0)),u=!tt.test(p.charAt(p.length-1)),n||!f&&!u)continue;if(f){for(At.currentNode=a;(g=At.previousPONode())&&!("IMG"===(l=g.nodeName)||"#text"===l&&/\S/.test(g.data));)if(!r(g)){g=null;break}p=p.replace(/^\s+/g,g?" ":"")}if(u){for(At.currentNode=a;(g=At.nextNode())&&!("IMG"===l||"#text"===l&&/\S/.test(g.data));)if(!r(g)){g=null;break}p=p.replace(/\s+$/g,g?" ":"")}if(p){a.data=p;continue}}e.removeChild(a),o-=1,s-=1}return e},$t=function t(e){for(var n,i=e.childNodes,s=i.length;s--;)(n=i[s]).nodeType!==$||o(n)?n.nodeType!==D||n.data||e.removeChild(n):(t(n),r(n)&&!n.firstChild&&e.removeChild(n))},Dt=function(t){return t.nodeType===$?"BR"===t.nodeName:tt.test(t.data)},Ut=function(t){for(var e,i=t.parentNode;r(i);)i=i.parentNode;return e=new n(i,4|R,Dt),e.currentNode=t,!!e.nextNode()},It=function(t,e){var n,i,o,s=t.querySelectorAll("BR"),a=[],l=s.length;for(n=0;n<l;n+=1)a[n]=Ut(s[n]);for(;l--;)(o=(i=s[l]).parentNode)&&(a[l]?r(o)||_(o,e):v(i))},Rt=function(t){var e=t.clipboardData,n=this.getSelection(),i=this.createElement("div"),o=this._root,r=this;this.saveUndoState(n),Y||z||!e?setTimeout(function(){try{r._ensureBottomLine()}catch(t){r.didError(t)}},0):(ut(n,o),i.appendChild(dt(n,o)),e.setData("text/html",i.innerHTML),e.setData("text/plain",i.innerText||i.textContent),t.preventDefault()),this.setSelection(n)},Ft=function(t){var e=t.clipboardData,n=this.getSelection(),i=this.createElement("div");Y||z||!e||(i.appendChild(n.cloneContents()),e.setData("text/html",i.innerHTML),e.setData("text/plain",i.innerText||i.textContent),t.preventDefault())},Mt=function(t){var e,n,i,o,r,s=t.clipboardData,a=s&&s.items,l=!1,d=!1,h=null,c=this;if(Y||!a){if(o=s&&s.types,!Y&&o&&(et.call(o,"text/html")>-1||!q&&et.call(o,"text/plain")>-1&&et.call(o,"text/rtf")<0))return t.preventDefault(),void((r=s.getData("text/html"))?this.insertHTML(r,!0):((r=s.getData("text/plain"))||(r=s.getData("text/uri-list")))&&this.insertPlainText(r,!0));this._awaitingPaste=!0;var f=this._doc.body,u=this.getSelection(),p=u.startContainer,g=u.startOffset,m=u.endContainer,b=u.endOffset,C=this.createElement("DIV",{contenteditable:"true",style:"position:fixed; overflow:hidden; top:0; right:100%; width:1px; height:1px;"});f.appendChild(C),u.selectNodeContents(C),this.setSelection(u),setTimeout(function(){try{c._awaitingPaste=!1;for(var t,e,n="",i=C;C=i;)i=C.nextSibling,v(C),(t=C.firstChild)&&t===C.lastChild&&"DIV"===t.nodeName&&(C=t),n+=C.innerHTML;e=c._createRange(p,g,m,b),c.setSelection(e),n&&c.insertHTML(n,!0)}catch(t){c.didError(t)}},0)}else{for(t.preventDefault(),e=a.length;e--;){if(n=a[e],"text/html"===(i=n.type))return void n.getAsString(function(t){c.insertHTML(t,!0)});"text/plain"===i&&(h=n),/^image\/.*/.test(i)&&(d=!0)}d?(this.fireEvent("dragover",{dataTransfer:s,preventDefault:function(){l=!0}}),l&&this.fireEvent("drop",{dataTransfer:s})):h&&n.getAsString(function(t){c.insertPlainText(t,!0)})}},Wt=function(t){for(var e=t.dataTransfer.types,n=e.length,i=!1,o=!1;n--;)switch(e[n]){case"text/plain":i=!0;break;case"text/html":o=!0;break;default:return}(o||i)&&this.saveUndoState()},zt=[],Ht=w.prototype;Ht.setConfig=function(t){return t=O({blockTag:"DIV",blockAttributes:null,tagAttributes:{blockquote:null,ul:null,ol:null,li:null,a:null}},t),t.blockTag=t.blockTag.toUpperCase(),this._config=t,this},Ht.createElement=function(t,e,n){return y(this._doc,t,e,n)},Ht.createDefaultBlock=function(t){var e=this._config;return S(this.createElement(e.blockTag,e.blockAttributes,t),this._root)},Ht.didError=function(t){console.log(t)},Ht.getDocument=function(){return this._doc},Ht.getRoot=function(){return this._root},Ht.modifyDocument=function(t){this._ignoreAllChanges=!0,this._mutation&&this._mutation.disconnect(),t(),this._ignoreAllChanges=!1,this._mutation&&this._mutation.observe(this._root,{childList:!0,attributes:!0,characterData:!0,subtree:!0})};var qt={pathChange:1,select:1,input:1,undoStateChange:1};Ht.fireEvent=function(t,e){var n,i,o=this._events[t];if(o)for(e||(e={}),e.type!==t&&(e.type=t),n=(o=o.slice()).length;n--;){i=o[n];try{i.handleEvent?i.handleEvent(e):i.call(this,e)}catch(e){e.details="Squire: fireEvent error. Event type: "+t,this.didError(e)}}return this},Ht.destroy=function(){var t,e=zt.length,n=this._events;for(t in n)this.removeEventListener(t);for(this._mutation&&this._mutation.disconnect();e--;)zt[e]===this&&zt.splice(e,1)},Ht.handleEvent=function(t){this.fireEvent(t.type,t)},Ht.addEventListener=function(t,e){var n=this._events[t],i=this._root;return e?(n||(n=this._events[t]=[],qt[t]||("selectionchange"===t&&(i=this._doc),i.addEventListener(t,this,!0))),n.push(e),this):(this.didError({name:"Squire: addEventListener with null or undefined fn",message:"Event type: "+t}),this)},Ht.removeEventListener=function(t,e){var n,i=this._events[t],o=this._root;if(i){if(e)for(n=i.length;n--;)i[n]===e&&i.splice(n,1);else i.length=0;i.length||(delete this._events[t],qt[t]||("selectionchange"===t&&(o=this._doc),o.removeEventListener(t,this,!0)))}return this},Ht._createRange=function(t,e,n,i){if(t instanceof this._win.Range)return t.cloneRange();var o=this._doc.createRange();return o.setStart(t,e),n?o.setEnd(n,i):o.setEnd(t,e),o},Ht.getCursorPosition=function(t){if(!t&&!(t=this.getSelection())||!t.getBoundingClientRect)return null;var e,n,i=t.getBoundingClientRect();return i&&!i.top&&(this._ignoreChange=!0,(e=this._doc.createElement("SPAN")).textContent=F,at(t,e),i=e.getBoundingClientRect(),(n=e.parentNode).removeChild(e),N(n,{startContainer:t.startContainer,endContainer:t.endContainer,startOffset:t.startOffset,endOffset:t.endOffset})),i},Ht._moveCursorTo=function(t){var e=this._root,n=this._createRange(e,t?0:e.childNodes.length);return ft(n),this.setSelection(n),this},Ht.moveCursorToStart=function(){return this._moveCursorTo(!0)},Ht.moveCursorToEnd=function(){return this._moveCursorTo(!1)};var jt=function(t){return t._win.getSelection()||null};Ht.setSelection=function(t){if(t){this._restoreSelection=!1,this._lastSelection=t,z&&this._win.focus();var e=jt(this);e&&(e.removeAllRanges(),e.addRange(t))}return this},Ht.getSelection=function(){var t,e,n,i=jt(this),r=this._root;return i&&i.rangeCount&&(e=(t=i.getRangeAt(0).cloneRange()).startContainer,n=t.endContainer,e&&o(e)&&t.setStartBefore(e),n&&o(n)&&t.setEndBefore(n)),t&&p(r,t.commonAncestorContainer)?this._lastSelection=t:t=this._lastSelection,t||(t=this._createRange(r.firstChild,0)),t},Ht.getSelectedText=function(){var t,e=this.getSelection(),i=new n(e.commonAncestorContainer,4|R,function(t){return ct(e,t,!0)}),o=e.startContainer,s=e.endContainer,a=i.currentNode=o,l="",d=!1;for(i.filter(a)||(a=i.nextNode());a;)a.nodeType===D?(t=a.data)&&/\S/.test(t)&&(a===s&&(t=t.slice(0,e.endOffset)),a===o&&(t=t.slice(e.startOffset)),l+=t,d=!0):("BR"===a.nodeName||d&&!r(a))&&(l+="\n",d=!1),a=i.nextNode();return l},Ht.getPath=function(){return this._path};var Qt=function(t){for(var e,i,o,s=new n(t,4,function(){return!0},!1);i=s.nextNode();)for(;(o=i.data.indexOf(F))>-1;){if(1===i.length){do{(e=i.parentNode).removeChild(i),i=e,s.currentNode=e}while(r(i)&&!m(i));break}i.deleteData(o,1)}};Ht._didAddZWS=function(){this._hasZWS=!0},Ht._removeZWS=function(){this._hasZWS&&(Qt(this._root),this._hasZWS=!1)},Ht._updatePath=function(t,e){var n,i=t.startContainer,o=t.endContainer;(e||i!==this._lastAnchorNode||o!==this._lastFocusNode)&&(this._lastAnchorNode=i,this._lastFocusNode=o,n=i&&o?i===o?g(o,this._root):"(selection)":"",this._path!==n&&(this._path=n,this.fireEvent("pathChange",{path:n}))),t.collapsed||this.fireEvent("select")},Ht._updatePathOnEvent=function(){this._updatePath(this.getSelection())},Ht.focus=function(){return this._root.focus(),this},Ht.blur=function(){return this._root.blur(),this};Ht._saveRangeToBookmark=function(t){var e,n=this.createElement("INPUT",{id:"squire-selection-start",type:"hidden"}),i=this.createElement("INPUT",{id:"squire-selection-end",type:"hidden"});at(t,n),t.collapse(!1),at(t,i),2&n.compareDocumentPosition(i)&&(n.id="squire-selection-end",i.id="squire-selection-start",e=n,n=i,i=e),t.setStartAfter(n),t.setEndBefore(i)},Ht._getRangeAndRemoveBookmark=function(t){var e=this._root,n=e.querySelector("#squire-selection-start"),i=e.querySelector("#squire-selection-end");if(n&&i){var o=n.parentNode,r=i.parentNode,s={startContainer:o,endContainer:r,startOffset:et.call(o.childNodes,n),endOffset:et.call(r.childNodes,i)};o===r&&(s.endOffset-=1),v(n),v(i),N(o,s),o!==r&&N(r,s),t||(t=this._doc.createRange()),t.setStart(s.startContainer,s.startOffset),t.setEnd(s.endContainer,s.endOffset),t.collapsed&&(o=t.startContainer).nodeType===D&&((r=o.childNodes[t.startOffset])&&r.nodeType===D||(r=o.childNodes[t.startOffset-1]),r&&r.nodeType===D&&(t.setStart(r,0),t.collapse(!0)))}return t||null},Ht._keyUpDetectChange=function(t){var e=t.keyCode;t.ctrlKey||t.metaKey||t.altKey||!(e<16||e>20)||!(e<33||e>45)||this._docWasChanged()},Ht._docWasChanged=function(){this._ignoreAllChanges||(J&&this._ignoreChange?this._ignoreChange=!1:(this._isInUndoState&&(this._isInUndoState=!1,this.fireEvent("undoStateChange",{canUndo:!0,canRedo:!1})),this.fireEvent("input")))},Ht._recordUndoState=function(t){if(!this._isInUndoState){var e=this._undoIndex+=1,n=this._undoStack;e<this._undoStackLength&&(n.length=this._undoStackLength=e),t&&this._saveRangeToBookmark(t),n[e]=this._getHTML(),this._undoStackLength+=1,this._isInUndoState=!0}},Ht.saveUndoState=function(t){return t===e&&(t=this.getSelection()),this._isInUndoState||(this._recordUndoState(t),this._getRangeAndRemoveBookmark(t)),this},Ht.undo=function(){if(0!==this._undoIndex||!this._isInUndoState){this._recordUndoState(this.getSelection()),this._undoIndex-=1,this._setHTML(this._undoStack[this._undoIndex]);var t=this._getRangeAndRemoveBookmark();t&&this.setSelection(t),this._isInUndoState=!0,this.fireEvent("undoStateChange",{canUndo:0!==this._undoIndex,canRedo:!0}),this.fireEvent("input")}return this},Ht.redo=function(){var t=this._undoIndex,e=this._undoStackLength;if(t+1<e&&this._isInUndoState){this._undoIndex+=1,this._setHTML(this._undoStack[this._undoIndex]);var n=this._getRangeAndRemoveBookmark();n&&this.setSelection(n),this.fireEvent("undoStateChange",{canUndo:!0,canRedo:t+2<e}),this.fireEvent("input")}return this},Ht.hasFormat=function(t,e,i){if(t=t.toUpperCase(),e||(e={}),!i&&!(i=this.getSelection()))return!1;!i.collapsed&&i.startContainer.nodeType===D&&i.startOffset===i.startContainer.length&&i.startContainer.nextSibling&&i.setStartBefore(i.startContainer.nextSibling),!i.collapsed&&i.endContainer.nodeType===D&&0===i.endOffset&&i.endContainer.previousSibling&&i.setEndAfter(i.endContainer.previousSibling);var o,r,s=this._root,a=i.commonAncestorContainer;if(u(a,s,t,e))return!0;if(a.nodeType===D)return!1;o=new n(a,4,function(t){return ct(i,t,!0)},!1);for(var l=!1;r=o.nextNode();){if(!u(r,s,t,e))return!1;l=!0}return l},Ht.getFontInfo=function(t){var n,i,o,r={color:e,backgroundColor:e,family:e,size:e},s=0;if(!t&&!(t=this.getSelection()))return r;if(n=t.commonAncestorContainer,t.collapsed||n.nodeType===D)for(n.nodeType===D&&(n=n.parentNode);s<4&&n;)(i=n.style)&&(!r.color&&(o=i.color)&&(r.color=o,s+=1),!r.backgroundColor&&(o=i.backgroundColor)&&(r.backgroundColor=o,s+=1),!r.family&&(o=i.fontFamily)&&(r.family=o,s+=1),!r.size&&(o=i.fontSize)&&(r.size=o,s+=1)),n=n.parentNode;return r},Ht._addFormat=function(t,e,i){var o,r,s,a,l,d,h,c=this._root;if(i.collapsed)o=S(this.createElement(t,e),c),at(i,o),i.setStart(o.firstChild,o.firstChild.length),i.collapse(!0);else{if(r=new n(i.commonAncestorContainer,4|R,function(t){return(t.nodeType===D||"BR"===t.nodeName||"IMG"===t.nodeName)&&ct(i,t,!0)},!1),s=i.startContainer,l=i.startOffset,a=i.endContainer,d=i.endOffset,r.currentNode=s,r.filter(s)||(s=r.nextNode(),l=0),!s)return i;do{!u(h=r.currentNode,c,t,e)&&(h===a&&h.length>d&&h.splitText(d),h===s&&l&&(h=h.splitText(l),a===s&&(a=h,d-=l),s=h,l=0),b(h,o=this.createElement(t,e)),o.appendChild(h))}while(r.nextNode());a.nodeType!==D&&(h.nodeType===D?(a=h,d=h.length):(a=h.parentNode,d=1)),i=this._createRange(s,l,a,d)}return i},Ht._removeFormat=function(t,e,n,i){this._saveRangeToBookmark(n);var o,s=this._doc;n.collapsed&&(G?(o=s.createTextNode(F),this._didAddZWS()):o=s.createTextNode(""),at(n,o));for(var a=n.commonAncestorContainer;r(a);)a=a.parentNode;var l=n.startContainer,d=n.startOffset,h=n.endContainer,c=n.endOffset,u=[],p=function(t,e){if(!ct(n,t,!1)){var i,o,r=t.nodeType===D;if(ct(n,t,!0))if(r)t===h&&c!==t.length&&u.push([e,t.splitText(c)]),t===l&&d&&(t.splitText(d),u.push([e,t]));else for(i=t.firstChild;i;i=o)o=i.nextSibling,p(i,e);else"INPUT"===t.nodeName||r&&!t.data||u.push([e,t])}},g=Array.prototype.filter.call(a.getElementsByTagName(t),function(i){return ct(n,i,!0)&&f(i,t,e)});i||g.forEach(function(t){p(t,t)}),u.forEach(function(t){var e=t[0].cloneNode(!1),n=t[1];b(n,e),e.appendChild(n)}),g.forEach(function(t){b(t,C(t))}),this._getRangeAndRemoveBookmark(n),o&&n.collapse(!1);var m={startContainer:n.startContainer,startOffset:n.startOffset,endContainer:n.endContainer,endOffset:n.endOffset};return N(a,m),n.setStart(m.startContainer,m.startOffset),n.setEnd(m.endContainer,m.endOffset),n},Ht.changeFormat=function(t,e,n,i){if(n||(n=this.getSelection()))return this.saveUndoState(n),e&&(n=this._removeFormat(e.tag.toUpperCase(),e.attributes||{},n,i)),t&&(n=this._addFormat(t.tag.toUpperCase(),t.attributes||{},n)),this.setSelection(n),this._updatePath(n,!0),J||this._docWasChanged(),this};var Yt={DT:"DD",DD:"DT",LI:"LI"},Zt=function(t,e,n,i){var o=Yt[e.nodeName],r=null,s=x(n,i,e.parentNode,t._root),a=t._config;return o||(o=a.blockTag,r=a.blockAttributes),f(s,o,r)||(e=y(s.ownerDocument,o,r),s.dir&&(e.dir=s.dir),b(s,e),e.appendChild(C(s)),s=e),s};Ht.forEachBlock=function(t,e,n){if(!n&&!(n=this.getSelection()))return this;e&&this.saveUndoState(n);var i=this._root,o=pt(n,i),r=gt(n,i);if(o&&r)do{if(t(o)||o===r)break}while(o=h(o,i));return e&&(this.setSelection(n),this._updatePath(n,!0),J||this._docWasChanged()),this},Ht.modifyBlocks=function(t,e){if(!e&&!(e=this.getSelection()))return this;this._isInUndoState?this._saveRangeToBookmark(e):this._recordUndoState(e);var n,i=this._root;return Ct(e,i),ut(e,i),n=lt(e,i,i),at(e,t.call(this,n)),e.endOffset<e.endContainer.childNodes.length&&k(e.endContainer.childNodes[e.endOffset],i),k(e.startContainer.childNodes[e.startOffset],i),this._getRangeAndRemoveBookmark(e),this.setSelection(e),this._updatePath(e,!0),J||this._docWasChanged(),this};var Kt=function(t){var e=this._root,n=t.querySelectorAll("blockquote");return Array.prototype.filter.call(n,function(t){return!u(t.parentNode,e,"BLOCKQUOTE")}).forEach(function(t){b(t,C(t))}),t},Vt=function(){return this.createDefaultBlock([this.createElement("INPUT",{id:"squire-selection-start",type:"hidden"}),this.createElement("INPUT",{id:"squire-selection-end",type:"hidden"})])},Gt=function(t,e,n){for(var i,o,r,s,a=l(e,t._root),d=t._config.tagAttributes,h=d[n.toLowerCase()],c=d.li;i=a.nextNode();)"LI"!==(o=i.parentNode.nodeName)?(s=t.createElement("LI",c),i.dir&&(s.dir=i.dir),(r=i.previousSibling)&&r.nodeName===n?r.appendChild(s):b(i,t.createElement(n,h,[s])),s.appendChild(i)):(o=(i=i.parentNode.parentNode).nodeName)!==n&&/^[OU]L$/.test(o)&&b(i,t.createElement(n,h,[C(i)]))},Xt=function(t){var e,n,i,o,r,s,l=t.querySelectorAll("LI"),d=this._config.tagAttributes,h=d.li;for(e=0,n=l.length;e<n;e+=1)a((i=l[e]).firstChild)||(o=i.parentNode.nodeName,(r=i.previousSibling)&&(r=r.lastChild)&&r.nodeName===o||(s=d[o.toLowerCase()],b(i,this.createElement("LI",h,[r=this.createElement(o,s)]))),r.appendChild(i));return t},Jt=function(t){var e=this._root,n=t.querySelectorAll("LI");return Array.prototype.filter.call(n,function(t){return!a(t.firstChild)}).forEach(function(n){var i,o=n.parentNode,r=o.parentNode,s=n.firstChild,l=s;for(n.previousSibling&&(o=x(o,n,r,e));l&&(i=l.nextSibling,!a(l));)r.insertBefore(l,o),l=i;for("LI"===r.nodeName&&s.previousSibling&&x(r,s,r.parentNode,e);n!==t&&!n.childNodes.length;)(o=n.parentNode).removeChild(n),n=o},this),_(t,e),t};Ht._ensureBottomLine=function(){var t=this._root,e=t.lastElementChild;e&&e.nodeName===this._config.blockTag&&s(e)||t.appendChild(this.createDefaultBlock())},Ht.setKeyHandler=function(t,e){return this._keyHandlers[t]=e,this},Ht._getHTML=function(){return this._root.innerHTML},Ht._setHTML=function(t){var e=this._root,n=e;n.innerHTML=t;do{S(n,e)}while(n=h(n,e));this._ignoreChange=!0},Ht.getHTML=function(t){var e,n,i,o,r,s,a=[];if(t&&(s=this.getSelection())&&this._saveRangeToBookmark(s),V)for(n=e=this._root;n=h(n,e);)n.textContent||n.querySelector("BR")||(i=this.createElement("BR"),n.appendChild(i),a.push(i));if(o=this._getHTML().replace(/\u200B/g,""),V)for(r=a.length;r--;)v(a[r]);return s&&this._getRangeAndRemoveBookmark(s),o},Ht.setHTML=function(t){var e,n=this._doc.createDocumentFragment(),i=this.createElement("DIV"),o=this._root;i.innerHTML=t,n.appendChild(C(i)),Pt(n),It(n,o),_(n,o);for(var r=n;r=h(r,o);)S(r,o);for(this._ignoreChange=!0;e=o.lastChild;)o.removeChild(e);o.appendChild(n),S(o,o),this._undoIndex=-1,this._undoStack.length=0,this._undoStackLength=0,this._isInUndoState=!1;var s=this._getRangeAndRemoveBookmark()||this._createRange(o.firstChild,0);return this.saveUndoState(s),this._lastSelection=s,this._updatePath(s,!0),this},Ht.insertElement=function(t,e){if(e||(e=this.getSelection()),e.collapse(!0),r(t))at(e,t),e.setStartAfter(t);else{for(var n,i=this._root,o=pt(e,i)||i;o!==i&&!o.nextSibling;)o=o.parentNode;o!==i&&(n=x(o.parentNode,o.nextSibling,i,i)),n?i.insertBefore(t,n):(i.appendChild(t),n=this.createDefaultBlock(),i.appendChild(n)),e.setStart(n,0),e.setEnd(n,0),ft(e)}return this.focus(),this.setSelection(e),this._updatePath(e),J||this._docWasChanged(),this},Ht.insertImage=function(t,e){var n=this.createElement("IMG",O({src:t},e));return this.insertElement(n),n};var te=/\b((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))|([\w\-.%+]+@(?:[\w\-]+\.)+[A-Z]{2,}\b)/i,ee=function(t,e,i){for(var o,r,s,a,l,d,h,c=t.ownerDocument,f=new n(t,4,function(t){return!u(t,e,"A")},!1),p=i._config.tagAttributes.a;o=f.nextNode();)for(r=o.data,s=o.parentNode;a=te.exec(r);)d=(l=a.index)+a[0].length,l&&(h=c.createTextNode(r.slice(0,l)),s.insertBefore(h,o)),(h=i.createElement("A",O({href:a[1]?/^(?:ht|f)tps?:/.test(a[1])?a[1]:"http://"+a[1]:"mailto:"+a[2]},p))).textContent=r.slice(l,d),s.insertBefore(h,o),o.data=r=r.slice(d)};Ht.insertHTML=function(t,e){var n,i,o,r,s,a=this.getSelection(),l=this._doc.createDocumentFragment(),d=this.createElement("DIV");e&&(n=t.indexOf("\x3c!--StartFragment--\x3e"),i=t.lastIndexOf("\x3c!--EndFragment--\x3e"),n>-1&&i>-1&&(t=t.slice(n+20,i))),d.innerHTML=t,l.appendChild(C(d)),this.saveUndoState(a);try{for(o=this._root,r=l,s={fragment:l,preventDefault:function(){this.defaultPrevented=!0},defaultPrevented:!1},ee(l,l,this),Pt(l),It(l,null),$t(l),l.normalize();r=h(r,l);)S(r,null);e&&this.fireEvent("willPaste",s),s.defaultPrevented||(ht(a,s.fragment,o),J||this._docWasChanged(),a.collapse(!1),this._ensureBottomLine()),this.setSelection(a),this._updatePath(a,!0)}catch(t){this.didError(t)}return this};var ne=function(t){return t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")};Ht.insertPlainText=function(t,e){var n,i,o,r,s=t.split("\n"),a=this._config,l=a.blockTag,d=a.blockAttributes,h="</"+l+">",c="<"+l;for(n in d)c+=" "+n+'="'+ne(d[n])+'"';for(c+=">",i=0,o=s.length;i<o;i+=1)r=s[i],r=ne(r).replace(/ (?= )/g,"&nbsp;"),i&&i+1<o&&(r=c+(r||"<BR>")+h),s[i]=r;return this.insertHTML(s.join(""),e)};var ie=function(t,e,n){return function(){return this[t](e,n),this.focus()}};Ht.addStyles=function(t){if(t){var e=this._doc.documentElement.firstChild,n=this.createElement("STYLE",{type:"text/css"});n.appendChild(this._doc.createTextNode(t)),e.appendChild(n)}return this},Ht.bold=ie("changeFormat",{tag:"B"}),Ht.italic=ie("changeFormat",{tag:"I"}),Ht.underline=ie("changeFormat",{tag:"U"}),Ht.strikethrough=ie("changeFormat",{tag:"S"}),Ht.subscript=ie("changeFormat",{tag:"SUB"},{tag:"SUP"}),Ht.superscript=ie("changeFormat",{tag:"SUP"},{tag:"SUB"}),Ht.removeBold=ie("changeFormat",null,{tag:"B"}),Ht.removeItalic=ie("changeFormat",null,{tag:"I"}),Ht.removeUnderline=ie("changeFormat",null,{tag:"U"}),Ht.removeStrikethrough=ie("changeFormat",null,{tag:"S"}),Ht.removeSubscript=ie("changeFormat",null,{tag:"SUB"}),Ht.removeSuperscript=ie("changeFormat",null,{tag:"SUP"}),Ht.makeLink=function(t,e){var n=this.getSelection();if(n.collapsed){var i=t.indexOf(":")+1;if(i)for(;"/"===t[i];)i+=1;at(n,this._doc.createTextNode(t.slice(i)))}return e||(e={}),O(e,this._config.tagAttributes.a),e.href=t,this.changeFormat({tag:"A",attributes:e},{tag:"A"},n),this.focus()},Ht.removeLink=function(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0),this.focus()},Ht.setFontFace=function(t){return this.changeFormat({tag:"SPAN",attributes:{class:"font",style:"font-family: "+t+", sans-serif;"}},{tag:"SPAN",attributes:{class:"font"}}),this.focus()},Ht.setFontSize=function(t){return this.changeFormat({tag:"SPAN",attributes:{class:"size",style:"font-size: "+("number"==typeof t?t+"px":t)}},{tag:"SPAN",attributes:{class:"size"}}),this.focus()},Ht.setTextColour=function(t){return this.changeFormat({tag:"SPAN",attributes:{class:"colour",style:"color:"+t}},{tag:"SPAN",attributes:{class:"colour"}}),this.focus()},Ht.setHighlightColour=function(t){return this.changeFormat({tag:"SPAN",attributes:{class:"highlight",style:"background-color:"+t}},{tag:"SPAN",attributes:{class:"highlight"}}),this.focus()},Ht.setTextAlignment=function(t){return this.forEachBlock(function(e){e.className=(e.className.split(/\s+/).filter(function(t){return!/align/.test(t)}).join(" ")+" align-"+t).trim(),e.style.textAlign=t},!0),this.focus()},Ht.setTextDirection=function(t){return this.forEachBlock(function(e){e.dir=t},!0),this.focus()},Ht.removeAllFormatting=function(t){if(!t&&!(t=this.getSelection())||t.collapsed)return this;for(var e=this._root,n=t.commonAncestorContainer;n&&!s(n);)n=n.parentNode;if(n||(Ct(t,e),n=e),n.nodeType===D)return this;this.saveUndoState(t),ut(t,n);for(var i,o,r,a=n.ownerDocument,l=t.startContainer,d=t.startOffset,h=t.endContainer,c=t.endOffset,f=a.createDocumentFragment(),u=a.createDocumentFragment(),p=x(h,c,n,e),g=x(l,d,n,e);g!==p;)i=g.nextSibling,f.appendChild(g),g=i;return P(this,f,u),u.normalize(),g=u.firstChild,i=u.lastChild,r=n.childNodes,g?(n.insertBefore(u,p),d=et.call(r,g),c=et.call(r,i)+1):c=d=et.call(r,p),o={startContainer:n,startOffset:d,endContainer:n,endOffset:c},N(n,o),t.setStart(o.startContainer,o.startOffset),t.setEnd(o.endContainer,o.endOffset),ft(t),this.setSelection(t),this._updatePath(t,!0),this.focus()},Ht.increaseQuoteLevel=ie("modifyBlocks",function(t){return this.createElement("BLOCKQUOTE",this._config.tagAttributes.blockquote,[t])}),Ht.decreaseQuoteLevel=ie("modifyBlocks",Kt),Ht.makeUnorderedList=ie("modifyBlocks",function(t){return Gt(this,t,"UL"),t}),Ht.makeOrderedList=ie("modifyBlocks",function(t){return Gt(this,t,"OL"),t}),Ht.removeList=ie("modifyBlocks",function(t){var e,n,i,o,r,s,a,l=t.querySelectorAll("UL, OL");for(e=0,n=l.length;e<n;e+=1){for(i=(s=(r=C(o=l[e])).childNodes).length;i--;)b(a=s[i],C(a));_(r,this._root),b(o,r)}return t}),Ht.increaseListLevel=ie("modifyBlocks",Xt),Ht.decreaseListLevel=ie("modifyBlocks",Jt),"object"==typeof exports?module.exports=w:"function"==typeof define&&define.amd?define(function(){return w}):(M.Squire=w,top!==M&&"true"===t.documentElement.getAttribute("data-squireinit")&&(M.editor=new w(t),M.onEditorLoad&&(M.onEditorLoad(M.editor),M.onEditorLoad=null)))}(document),$(document).ready(function(){Squire.prototype.testPresenceinSelection=function(t,e,n,i){var o=this.getPath(),r=i.test(o)|this.hasFormat(n);return!(t!=e||!r)},Squire.prototype.checkPresenceinSelection=function(t,e,n){var i=this.getPath();return 1==(n.test(i)|this.hasFormat(e))},SquireUI=function(t){void 0===t.buildPath&&(t.buildPath="build/");var e;if(t.replace)e=$(t.replace).parent(),$(t.replace).remove();else{if(!t.div)throw new Error("No element was defined for the editor to inject to.");e=$(t.div)}var n=document.createElement("iframe");n.id=t.id+"-iframe",n.name=t.id+"-iframe",n.setAttribute("abm-menu",t.id+"-menu"),n.setAttribute("scrolling","no"),n.setAttribute("frameborder","0"),n.setAttribute("onload","resizeFrame(this)"),n.setAttribute("abmenabled",""+t.isEnabled),n.setAttribute("abmtoolbar",""+t.hasToolbar),n.className="abmiframe";var i=document.createElement("div");return i.id=t.id+"-div",i.className="Squire-UI input-field no-print ",$(i).load(t.buildPath+"Squire-UI.html",function(){$(i).find("#menu").attr("id",t.id+"-menu"),$(i).find("#"+t.id+"-menu").addClass("menu"+t.theme),t.hasToolbar&&t.isEnabled||$(i).find("#"+t.id+"-menu").addClass("hide"),$(i).find("[parent-menu='menu']").each(function(){$(this).attr("parent-menu",t.id+"-menu"),$(this).addClass("item-"+t.id)}),$(i).find("#abm-bold").attr("id",t.id+"-abm-bold"),$(i).find("#abm-italic").attr("id",t.id+"-abm-italic"),$(i).find("#abm-underline").attr("id",t.id+"-abm-underline"),$(i).find("#abm-link").attr("id",t.id+"-abm-link"),$(i).find("#abm-ordered").attr("id",t.id+"-abm-ordered"),$(i).find("#abm-quote").attr("id",t.id+"-abm-quote"),$(i).find("#makeLink").attr("id","makeLink-"+t.id),$(i).find("#insertImage").attr("id","insertImage-"+t.id),$(i).find("#insertFont").attr("id","insertFont-"+t.id),$(i).find("#drop-link").attr("id","drop-link-"+t.id),$(i).find("#drop-link-title").attr("id","drop-link-title-"+t.id),$(i).find("#drop-link-i").attr("id","drop-link-i-"+t.id),$(i).find("#drop-link-btn").attr("id","drop-link-btn-"+t.id),$(i).find("#drop-font").attr("id","drop-font-"+t.id),$(i).find("#drop-font-title").attr("id","drop-font-title-"+t.id),$(i).find("#drop-font-i").attr("id","drop-font-i-"+t.id),$(i).find("#drop-font-btn").attr("id","drop-font-btn-"+t.id),$(i).find("#drop-image").attr("id","drop-image-"+t.id),$(i).find("#drop-image-title").attr("id","drop-image-title-"+t.id),$(i).find("#drop-image-i").attr("id","drop-image-i-"+t.id),$(i).find("#drop-image-btn").attr("id","drop-image-btn-"+t.id),$(i).find("#url").attr("id","url-"+t.id),$(i).find("#imageUrl").attr("id","imageUrl-"+t.id),$(i).find("#font").attr("id","font-"+t.id),$(i).find("#drop-link-i-"+t.id).addClass("quit-"+t.id),$(i).find("#drop-image-i-"+t.id).addClass("quit-"+t.id),$(i).find("#drop-font-i-"+t.id).addClass("quit-"+t.id),$(i).find("#drop-link-btn-"+t.id).addClass("submitLink-"+t.id),$(i).find("#drop-image-btn-"+t.id).addClass("sumbitImageURL-"+t.id),$(i).find("#drop-font-btn-"+t.id).addClass("sumbitFont-"+t.id),$(i).find("#drop-link-title-"+t.id).addClass(t.dropboxTitleColor),$(i).find("#drop-image-title-"+t.id).addClass(t.dropboxTitleColor),$(i).find("#drop-font-title-"+t.id).addClass(t.dropboxTitleColor),$(i).find("#drop-link-i-"+t.id).addClass(t.dropboxTitleColor),$(i).find("#drop-image-i-"+t.id).addClass(t.dropboxTitleColor),$(i).find("#drop-font-i-"+t.id).addClass(t.dropboxTitleColor),$(i).find("#drop-link-title-"+t.id).text(t.dropboxLinkTitle),$(i).find("#drop-image-title-"+t.id).text(t.dropboxImageTitle),$(i).find("#drop-font-title-"+t.id).text(t.dropboxFontSizeTitle),$(i).find("#url-"+t.id).css({"border-bottom":"1px solid "+t.dropboxLineColor,"box-shadow":"0 1px 0 0 "+t.dropboxLineColor}),$(i).find("#imageUrl-"+t.id).css({"border-bottom":"1px solid "+t.dropboxLineColor,"box-shadow":"0 1px 0 0 "+t.dropboxLineColor}),$(i).find("#font-"+t.id).css({"border-bottom":"1px solid "+t.dropboxLineColor,"box-shadow":"0 1px 0 0 "+t.dropboxLineColor}),$(i).find("#url-"+t.id).addClass(t.dropboxTextColor),$(i).find("#imageUrl-"+t.id).addClass(t.dropboxTextColor),$(i).find("#font-"+t.id).addClass(t.dropboxTextColor),$(i).find("#drop-link-btn-"+t.id).addClass(t.dropboxButtonBackColor),$(i).find("#drop-link-btn-"+t.id).addClass(t.dropboxButtonForeColor),$(i).find("#drop-image-btn-"+t.id).addClass(t.dropboxButtonBackColor),$(i).find("#drop-image-btn-"+t.id).addClass(t.dropboxButtonForeColor),$(i).find("#drop-font-btn-"+t.id).addClass(t.dropboxButtonBackColor),$(i).find("#drop-font-btn-"+t.id).addClass(t.dropboxButtonForeColor),$(i).find("#drop-link-btn-"+t.id).text(t.dropboxLinkButtonText),$(i).find("#drop-image-btn-"+t.id).text(t.dropboxImageButtonText),$(i).find("#drop-font-btn-"+t.id).text(t.dropboxFontSizeButtonText),this.linkDrop=new Drop({target:$("#makeLink-"+t.id).first()[0],content:$("#drop-link-"+t.id).html(),position:"bottom center",openOn:"click"}),this.linkDrop.on("open",function(){$(".quit-"+t.id).click(function(){$(this).parent().parent().removeClass("drop-open")}),$(".submitLink-"+t.id).click(function(){n.contentWindow.editor.makeLink($(this).parent().children("#url-"+t.id).first().val()),$(this).parent().parent().removeClass("drop-open"),$(this).parent().children("#url-"+t.id).attr("value","")})}),this.imageDrop=new Drop({target:$("#insertImage-"+t.id).first()[0],content:$("#drop-image-"+t.id).html(),position:"bottom center",openOn:"click"}),this.imageDrop.on("open",function(){$(".quit-"+t.id).unbind().click(function(){$(this).parent().parent().removeClass("drop-open")}),$(".sumbitImageURL-"+t.id).unbind().click(function(){var e=n.contentWindow.editor;url=$(this).parent().children("#imageUrl-"+t.id).first()[0],e.insertImage(url.value),$(this).parent().parent().removeClass("drop-open"),$(this).parent().children("#imageUrl-"+t.id).attr("value","")})}),this.fontDrop=new Drop({target:$("#insertFont-"+t.id).first()[0],content:$("#drop-font-"+t.id).html(),position:"bottom center",openOn:"click"}),this.fontDrop.on("open",function(){$(".quit-"+t.id).unbind().click(function(){$(this).parent().parent().removeClass("drop-open")}),$(".sumbitFont-"+t.id).unbind().click(function(){var e=n.contentWindow.editor,i=$(this).parent().children("#font-"+t.id).first()[0].value+"px";"px"!=i&&e.setFontSize(i),$(this).parent().parent().removeClass("drop-open")})}),$(".item-"+t.id).click(function(){var t=$(this).parents(".Squire-UI").next("iframe").first()[0].contentWindow.editor,e=$(this).data("action");test={value:$(this).data("action"),testBold:t.testPresenceinSelection("bold",e,"B",/>B\b/),testItalic:t.testPresenceinSelection("italic",e,"I",/>I\b/),testUnderline:t.testPresenceinSelection("underline",e,"U",/>U\b/),testOrderedList:t.testPresenceinSelection("makeOrderedList",e,"OL",/>OL\b/),testLink:t.testPresenceinSelection("makeLink",e,"A",/>A\b/),testQuote:t.testPresenceinSelection("increaseQuoteLevel",e,"blockquote",/>blockquote\b/),isNotValue:function(t){return t==e&&""!==this.value}},t.alignRight=function(){t.setTextAlignment("right")},t.alignCenter=function(){t.setTextAlignment("center")},t.alignLeft=function(){t.setTextAlignment("left")},t.alignJustify=function(){t.setTextAlignment("justify")},t.makeHeading=function(){t.setFontSize("2em"),t.bold()},test.testBold|test.testItalic|test.testUnderline|test.testOrderedList|test.testLink|test.testQuote?(test.testBold&&t.removeBold(),test.testItalic&&t.removeItalic(),test.testUnderline&&t.removeUnderline(),test.testLink&&t.removeLink(),test.testOrderedList&&t.removeList(),test.testQuote&&t.decreaseQuoteLevel()):test.isNotValue("makeLink")|test.isNotValue("insertImage")|test.isNotValue("fontsize")||(t[e](),t.focus())})}),n.addEventListener("load",function(){var e=n.contentDocument;"CSS1Compat"!==e.compatMode&&(e.open(),e.write("<!DOCTYPE html><title></title>"),e.close()),n.contentWindow.editor||(n.contentWindow.editor=new Squire(n.contentWindow.document),n.contentWindow.editor.addStyles("html {  height: "+t.abmheight+";}body {  -moz-box-sizing: border-box;  -webkit-box-sizing: border-box;  box-sizing: border-box;  height: 100%;  padding: 0em 0em;  background: transparent;  color: "+t.textColor+";  font: 1rem arial, sans-serif;  cursor: text;}a {  text-decoration: underline;}h1 {  font-size: 138.5%;}h2 {  font-size: 123.1%;}h3 {  font-size: 108%;}h1,h2,h3,p {  margin: 1em 0;}h4,h5,h6 {  margin: 0;}ul, ol {  margin: 0 1em;  padding: 0 1em;}blockquote {  border-left: 2px solid "+t.blockQuoteColor+";  margin: 0;  padding: 0 10px;}"),$(n.contentWindow.document).on("keyup keydown autoresize",function(){resizeFrame(n)}),$(window).on("resize",function(){resizeFrame(n)}),n.contentWindow.editor.addEventListener("focus",function(){"true"==n.getAttribute("abmenabled")?$("#"+t.id+"-iframe").css({border:"2px solid "+t.activeBorderColor,"box-shadow":"inset 0 1px 2px rgba(0,0,0,0.075)"}):$("#"+t.id+"-iframe").css({border:"2px solid rgba(0,0,0,0.0)","box-shadow":"inset 0 1px 2px rgba(0,0,0,0.0)"})}),n.contentWindow.editor.addEventListener("blur",function(){"true"==n.getAttribute("abmenabled")?$("#"+t.id+"-iframe").css({border:"2px solid "+t.inactiveBorderColor,"box-shadow":"inset 0 1px 2px rgba(0,0,0,0.075)"}):$("#"+t.id+"-iframe").css({border:"2px solid rgba(0,0,0,0.0)","box-shadow":"inset 0 1px 2px rgba(0,0,0,0.0)"})}),n.contentWindow.editor.addEventListener("pathChange",function(){var e=n.contentWindow.editor,i=$(this).data("action");test={value:$(this).data("action"),testBold:e.checkPresenceinSelection("bold","B",/>B\b/),testItalic:e.checkPresenceinSelection("italic","I",/>I\b/),testUnderline:e.checkPresenceinSelection("underline","U",/>U\b/),testOrderedList:e.checkPresenceinSelection("makeOrderedList","OL",/>OL\b/),testLink:e.checkPresenceinSelection("makeLink","A",/>A\b/),testQuote:e.checkPresenceinSelection("increaseQuoteLevel","blockquote",/>blockquote\b/),isNotValue:function(t){return t==i&&""!==this.value}},test.testBold?$("#"+t.id+"-abm-bold").addClass(t.activeMenuColor):$("#"+t.id+"-abm-bold").removeClass(t.activeMenuColor),test.testItalic?$("#"+t.id+"-abm-italic").addClass(t.activeMenuColor):$("#"+t.id+"-abm-italic").removeClass(t.activeMenuColor),test.testUnderline?$("#"+t.id+"-abm-underline").addClass(t.activeMenuColor):$("#"+t.id+"-abm-underline").removeClass(t.activeMenuColor),test.testOrderedList?$("#"+t.id+"-abm-ordered").addClass(t.activeMenuColor):$("#"+t.id+"-abm-ordered").removeClass(t.activeMenuColor),test.testLink?$("#"+t.id+"-abm-link").addClass(t.activeMenuColor):$("#"+t.id+"-abm-link").removeClass(t.activeMenuColor),test.testQuote?$("#"+t.id+"-abm-quote").addClass(t.activeMenuColor):$("#"+t.id+"-abm-quote").removeClass(t.activeMenuColor)}),t.isEnabled?$("#"+t.id+"-iframe").css({border:"2px solid "+t.inactiveBorderColor,"background-color":t.backColor,"box-shadow":"inset 0 1px 2px rgba(0,0,0,0.075)"}):$("#"+t.id+"-iframe").css({border:"2px solid rgba(0,0,0,0.0)","background-color":t.backColor,"box-shadow":"inset 0 1px 2px rgba(0,0,0,0.0)"}),resizeFrame(n))}),$(e).append(i),$(e).append(n),""==t.arrayName?b4j_raiseEvent("page_parseevent",{eventname:t.realId+"_loaded",eventparams:"target",target:t.realId}):b4j_raiseEvent("page_parseevent",{eventname:t.arrayName+"_loaded",eventparams:"target",target:t.realId}),n.contentWindow?n.contentWindow.editor:null}}),function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e(require,exports,module):t.Tether=e()}(this,function(){return function(){var t,e,n,i,o,r,s,a,l,d,h,c,f,u,p,g,m={}.hasOwnProperty,v=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},b=[].slice;null==this.Tether&&(this.Tether={modules:[]}),h=function(t){var e,n,i,o;if("fixed"===(n=getComputedStyle(t).position))return t;for(void 0,e=t;e=e.parentNode;){try{i=getComputedStyle(e)}catch(t){}if(null==i)return e;if(/(auto|scroll)/.test(i.overflow+i["overflow-y"]+i["overflow-x"])&&("absolute"!==n||"relative"===(o=i.position)||"absolute"===o||"fixed"===o))return e}return document.body},u=function(){var t;return t=0,function(){return t++}}(),g={},l=function(t){var e,i,r,s,a;if(null==(r=t._tetherZeroElement)&&((r=t.createElement("div")).setAttribute("data-tether-id",u()),o(r.style,{top:0,left:0,position:"absolute"}),t.body.appendChild(r),t._tetherZeroElement=r),e=r.getAttribute("data-tether-id"),null==g[e]){g[e]={},a=r.getBoundingClientRect();for(i in a)s=a[i],g[e][i]=s;n(function(){return g[e]=void 0})}return g[e]},s=function(t){var e,n,i,o,r,s,a;t===document?(n=document,t=document.documentElement):n=t.ownerDocument,i=n.documentElement,e={},a=t.getBoundingClientRect();for(o in a)s=a[o],e[o]=s;return r=l(n),e.top-=r.top,e.left-=r.left,null==e.width&&(e.width=document.body.scrollWidth-e.left-e.right),null==e.height&&(e.height=document.body.scrollHeight-e.top-e.bottom),e.top=e.top-i.clientTop,e.left=e.left-i.clientLeft,e.right=n.body.clientWidth-e.width-e.left,e.bottom=n.body.clientHeight-e.height-e.top,e},a=function(t){return t.offsetParent||document.documentElement},d=function(){var t,e,n,i,r;return t=document.createElement("div"),t.style.width="100%",t.style.height="200px",e=document.createElement("div"),o(e.style,{position:"absolute",top:0,left:0,pointerEvents:"none",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),e.appendChild(t),document.body.appendChild(e),i=t.offsetWidth,e.style.overflow="scroll",r=t.offsetWidth,i===r&&(r=e.clientWidth),document.body.removeChild(e),n=i-r,{width:n,height:n}},o=function(t){var e,n,i,o,r,s,a;for(null==t&&(t={}),e=[],Array.prototype.push.apply(e,arguments),r=0,s=(a=e.slice(1)).length;s>r;r++)if(i=a[r])for(n in i)m.call(i,n)&&(o=i[n],t[n]=o);return t},f=function(t,e){var n,i,o,r,s;if(null!=t.classList){for(s=[],i=0,o=(r=e.split(" ")).length;o>i;i++)(n=r[i]).trim()&&s.push(t.classList.remove(n));return s}return t.className=t.className.replace(new RegExp("(^| )"+e.split(" ").join("|")+"( |$)","gi")," ")},e=function(t,e){var n,i,o,r,s;if(null!=t.classList){for(s=[],i=0,o=(r=e.split(" ")).length;o>i;i++)(n=r[i]).trim()&&s.push(t.classList.add(n));return s}return f(t,e),t.className+=" "+e},c=function(t,e){return null!=t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)},p=function(t,n,i){var o,r,s,a,l,d;for(r=0,a=i.length;a>r;r++)o=i[r],v.call(n,o)<0&&c(t,o)&&f(t,o);for(d=[],s=0,l=n.length;l>s;s++)o=n[s],d.push(c(t,o)?void 0:e(t,o));return d},i=[],n=function(t){return i.push(t)},r=function(){var t,e;for(e=[];t=i.pop();)e.push(t());return e},t=function(){function t(){}return t.prototype.on=function(t,e,n,i){var o;return null==i&&(i=!1),null==this.bindings&&(this.bindings={}),null==(o=this.bindings)[t]&&(o[t]=[]),this.bindings[t].push({handler:e,ctx:n,once:i})},t.prototype.once=function(t,e,n){return this.on(t,e,n,!0)},t.prototype.off=function(t,e){var n,i,o;if(null!=(null!=(i=this.bindings)?i[t]:void 0)){if(null==e)return delete this.bindings[t];for(n=0,o=[];n<this.bindings[t].length;)o.push(this.bindings[t][n].handler===e?this.bindings[t].splice(n,1):n++);return o}},t.prototype.trigger=function(){var t,e,n,i,o,r,s,a,l;if(n=arguments[0],t=2<=arguments.length?b.call(arguments,1):[],null!=(s=this.bindings)?s[n]:void 0){for(o=0,l=[];o<this.bindings[n].length;)a=this.bindings[n][o],i=a.handler,e=a.ctx,r=a.once,i.apply(null!=e?e:this,t),l.push(r?this.bindings[n].splice(o,1):o++);return l}},t}(),this.Tether.Utils={getScrollParent:h,getBounds:s,getOffsetParent:a,extend:o,addClass:e,removeClass:f,hasClass:c,updateClasses:p,defer:n,flush:r,uniqueId:u,Evented:t,getScrollBarSize:d}}.call(this),function(){var t,e,n,i,o,r,s,a,l,d,h,c,f,u,p,g,m,v,b,C,y,S,_,x,N,T,k,E=[].slice,O=function(t,e){return function(){return t.apply(e,arguments)}};if(null==this.Tether)throw new Error("You must include the utils.js file before tether.js");k=(i=this.Tether).Utils,p=k.getScrollParent,k.getSize,k.getOuterSize,c=k.getBounds,f=k.getOffsetParent,d=k.extend,o=k.addClass,y=k.removeClass,x=k.updateClasses,l=k.defer,h=k.flush,u=k.getScrollBarSize,N=function(t,e,n){return null==n&&(n=1),t+n>=e&&e>=t-n},_=function(){var t,e,n,i,o;for(t=document.createElement("div"),n=0,i=(o=["transform","webkitTransform","OTransform","MozTransform","msTransform"]).length;i>n;n++)if(e=o[n],void 0!==t.style[e])return e}(),S=[],C=function(){var t,e;for(t=0,e=S.length;e>t;t++)S[t].position(!1);return h()},g=function(){var t;return null!=(t="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance.now():void 0)?t:+new Date},function(){var t,e,n,i,o,r,s,a,l;for(e=null,n=null,i=null,o=function(){return null!=n&&n>16?(n=Math.min(n-16,250),void(i=setTimeout(o,250))):null!=e&&g()-e<10?void 0:(null!=i&&(clearTimeout(i),i=null),e=g(),C(),n=g()-e)},l=[],r=0,s=(a=["resize","scroll","touchmove"]).length;s>r;r++)t=a[r],l.push(window.addEventListener(t,o))}(),t={center:"center",left:"right",right:"left"},e={middle:"middle",top:"bottom",bottom:"top"},n={top:0,left:0,middle:"50%",center:"50%",bottom:"100%",right:"100%"},a=function(n,i){var o,r;return o=n.left,r=n.top,"auto"===o&&(o=t[i.left]),"auto"===r&&(r=e[i.top]),{left:o,top:r}},s=function(t){var e,i;return{left:null!=(e=n[t.left])?e:t.left,top:null!=(i=n[t.top])?i:t.top}},r=function(){var t,e,n,i,o,r,s;for(n={top:0,left:0},o=0,r=(e=1<=arguments.length?E.call(arguments,0):[]).length;r>o;o++)s=e[o],i=s.top,t=s.left,"string"==typeof i&&(i=parseFloat(i,10)),"string"==typeof t&&(t=parseFloat(t,10)),n.top+=i,n.left+=t;return n},m=function(t,e){return"string"==typeof t.left&&-1!==t.left.indexOf("%")&&(t.left=parseFloat(t.left,10)/100*e.width),"string"==typeof t.top&&-1!==t.top.indexOf("%")&&(t.top=parseFloat(t.top,10)/100*e.height),t},v=b=function(t){var e,n,i;return i=t.split(" "),n=i[0],e=i[1],{top:n,left:e}},T=function(){function t(t){this.position=O(this.position,this);var e,n,o,r,s;for(S.push(this),this.history=[],this.setOptions(t,!1),n=0,o=(r=i.modules).length;o>n;n++)e=r[n],null!=(s=e.initialize)&&s.call(this);this.position()}return t.modules=[],t.prototype.getClass=function(t){var e,n;return(null!=(e=this.options.classes)?e[t]:void 0)?this.options.classes[t]:!1!==(null!=(n=this.options.classes)?n[t]:void 0)?this.options.classPrefix?this.options.classPrefix+"-"+t:t:""},t.prototype.setOptions=function(t,e){var n,i,r,s,a,l;for(this.options=t,null==e&&(e=!0),n={offset:"0 0",targetOffset:"0 0",targetAttachment:"auto auto",classPrefix:"tether"},this.options=d(n,this.options),a=this.options,this.element=a.element,this.target=a.target,this.targetModifier=a.targetModifier,"viewport"===this.target?(this.target=document.body,this.targetModifier="visible"):"scroll-handle"===this.target&&(this.target=document.body,this.targetModifier="scroll-handle"),r=0,s=(l=["element","target"]).length;s>r;r++){if(i=l[r],null==this[i])throw new Error("Tether Error: Both element and target must be defined");null!=this[i].jquery?this[i]=this[i][0]:"string"==typeof this[i]&&(this[i]=document.querySelector(this[i]))}if(o(this.element,this.getClass("element")),o(this.target,this.getClass("target")),!this.options.attachment)throw new Error("Tether Error: You must provide an attachment");return this.targetAttachment=v(this.options.targetAttachment),this.attachment=v(this.options.attachment),this.offset=b(this.options.offset),this.targetOffset=b(this.options.targetOffset),null!=this.scrollParent&&this.disable(),this.scrollParent="scroll-handle"===this.targetModifier?this.target:p(this.target),!1!==this.options.enabled?this.enable(e):void 0},t.prototype.getTargetBounds=function(){var t,e,n,i,o,r,s,a,l;if(null==this.targetModifier)return c(this.target);switch(this.targetModifier){case"visible":return this.target===document.body?{top:pageYOffset,left:pageXOffset,height:innerHeight,width:innerWidth}:(t=c(this.target),o={height:t.height,width:t.width,top:t.top,left:t.left},o.height=Math.min(o.height,t.height-(pageYOffset-t.top)),o.height=Math.min(o.height,t.height-(t.top+t.height-(pageYOffset+innerHeight))),o.height=Math.min(innerHeight,o.height),o.height-=2,o.width=Math.min(o.width,t.width-(pageXOffset-t.left)),o.width=Math.min(o.width,t.width-(t.left+t.width-(pageXOffset+innerWidth))),o.width=Math.min(innerWidth,o.width),o.width-=2,o.top<pageYOffset&&(o.top=pageYOffset),o.left<pageXOffset&&(o.left=pageXOffset),o);case"scroll-handle":return l=this.target,l===document.body?(l=document.documentElement,t={left:pageXOffset,top:pageYOffset,height:innerHeight,width:innerWidth}):t=c(l),a=getComputedStyle(l),n=l.scrollWidth>l.clientWidth||"scroll"===[a.overflow,a.overflowX]||this.target!==document.body,r=0,n&&(r=15),i=t.height-parseFloat(a.borderTopWidth)-parseFloat(a.borderBottomWidth)-r,o={width:15,height:.975*i*(i/l.scrollHeight),left:t.left+t.width-parseFloat(a.borderLeftWidth)-15},e=0,408>i&&this.target===document.body&&(e=-11e-5*Math.pow(i,2)-.00727*i+22.58),this.target!==document.body&&(o.height=Math.max(o.height,24)),s=this.target.scrollTop/(l.scrollHeight-i),o.top=s*(i-o.height-e)+t.top+parseFloat(a.borderTopWidth),this.target===document.body&&(o.height=Math.max(o.height,24)),o}},t.prototype.clearCache=function(){return this._cache={}},t.prototype.cache=function(t,e){return null==this._cache&&(this._cache={}),null==this._cache[t]&&(this._cache[t]=e.call(this)),this._cache[t]},t.prototype.enable=function(t){return null==t&&(t=!0),o(this.target,this.getClass("enabled")),o(this.element,this.getClass("enabled")),this.enabled=!0,this.scrollParent!==document&&this.scrollParent.addEventListener("scroll",this.position),t?this.position():void 0},t.prototype.disable=function(){return y(this.target,this.getClass("enabled")),y(this.element,this.getClass("enabled")),this.enabled=!1,null!=this.scrollParent?this.scrollParent.removeEventListener("scroll",this.position):void 0},t.prototype.destroy=function(){var t,e,n,i;for(this.disable(),i=[],t=e=0,n=S.length;n>e;t=++e){if(S[t]===this){S.splice(t,1);break}i.push(void 0)}return i},t.prototype.updateAttachClasses=function(t,e){var n,i,o,r,s,a,d,h,c,f=this;for(null==t&&(t=this.attachment),null==e&&(e=this.targetAttachment),r=["left","top","bottom","right","middle","center"],(null!=(c=this._addAttachClasses)?c.length:void 0)&&this._addAttachClasses.splice(0,this._addAttachClasses.length),n=null!=this._addAttachClasses?this._addAttachClasses:this._addAttachClasses=[],t.top&&n.push(this.getClass("element-attached")+"-"+t.top),t.left&&n.push(this.getClass("element-attached")+"-"+t.left),e.top&&n.push(this.getClass("target-attached")+"-"+e.top),e.left&&n.push(this.getClass("target-attached")+"-"+e.left),i=[],s=0,d=r.length;d>s;s++)o=r[s],i.push(this.getClass("element-attached")+"-"+o);for(a=0,h=r.length;h>a;a++)o=r[a],i.push(this.getClass("target-attached")+"-"+o);return l(function(){return null!=f._addAttachClasses?(x(f.element,f._addAttachClasses,i),x(f.target,f._addAttachClasses,i),f._addAttachClasses=void 0):void 0})},t.prototype.position=function(t){var e,n,o,l,d,p,g,v,b,C,y,S,_,x,N,T,k,E,O,w,L,B,A,P,$,D,U,I,R,F,M,W,z,H,q=this;if(null==t&&(t=!0),this.enabled){for(this.clearCache(),O=a(this.targetAttachment,this.attachment),this.updateAttachClasses(this.attachment,O),P=(e=this.cache("element-bounds",function(){return c(q.element)})).width,n=e.height,0===P&&0===n&&null!=this.lastSize?(R=this.lastSize,P=R.width,n=R.height):this.lastSize={width:P,height:n},B=L=this.cache("target-bounds",function(){return q.getTargetBounds()}),v=m(s(this.attachment),{width:P,height:n}),w=m(s(O),B),l=m(this.offset,{width:P,height:n}),d=m(this.targetOffset,B),v=r(v,l),w=r(w,d),o=L.left+w.left-v.left,A=L.top+w.top-v.top,$=0,U=(F=i.modules).length;U>$;$++)if(p=F[$],null!=(x=p.position.call(this,{left:o,top:A,targetAttachment:O,targetPos:L,attachment:this.attachment,elementPos:e,offset:v,targetOffset:w,manualOffset:l,manualTargetOffset:d,scrollbarSize:k}))&&"object"==typeof x){if(!1===x)return!1;A=x.top,o=x.left}if(g={page:{top:A,left:o},viewport:{top:A-pageYOffset,bottom:pageYOffset-A-n+innerHeight,left:o-pageXOffset,right:pageXOffset-o-P+innerWidth}},document.body.scrollWidth>window.innerWidth&&(k=this.cache("scrollbar-size",u),g.viewport.bottom-=k.height),document.body.scrollHeight>window.innerHeight&&(k=this.cache("scrollbar-size",u),g.viewport.right-=k.width),(""!==(M=document.body.style.position)&&"static"!==M||""!==(W=document.body.parentElement.style.position)&&"static"!==W)&&(g.page.bottom=document.body.scrollHeight-A-n,g.page.right=document.body.scrollWidth-o-P),!1!==(null!=(z=this.options.optimizations)?z.moveElement:void 0)&&null==this.targetModifier){for(C=this.cache("target-offsetparent",function(){return f(q.target)}),_=this.cache("target-offsetparent-bounds",function(){return c(C)}),S=getComputedStyle(C),getComputedStyle(this.element),y=_,b={},D=0,I=(H=["Top","Left","Bottom","Right"]).length;I>D;D++)E=H[D],b[E.toLowerCase()]=parseFloat(S["border"+E+"Width"]);_.right=document.body.scrollWidth-_.left-y.width+b.right,_.bottom=document.body.scrollHeight-_.top-y.height+b.bottom,g.page.top>=_.top+b.top&&g.page.bottom>=_.bottom&&g.page.left>=_.left+b.left&&g.page.right>=_.right&&(T=C.scrollTop,N=C.scrollLeft,g.offset={top:g.page.top-_.top+T-b.top,left:g.page.left-_.left+N-b.left})}return this.move(g),this.history.unshift(g),this.history.length>3&&this.history.pop(),t&&h(),!0}},t.prototype.move=function(t){var e,n,i,o,r,s,a,h,c,u,p,g,m,v,b,C,y,S=this;if(null!=this.element.parentNode){h={};for(u in t){h[u]={};for(o in t[u]){for(i=!1,v=0,b=(C=this.history).length;b>v;v++)if(a=C[v],!N(null!=(y=a[u])?y[o]:void 0,t[u][o])){i=!0;break}i||(h[u][o]=!0)}}e={top:"",left:"",right:"",bottom:""},c=function(t,n){var i,o,r;return!1===(null!=(r=S.options.optimizations)?r.gpu:void 0)?(t.top?e.top=n.top+"px":e.bottom=n.bottom+"px",t.left?e.left=n.left+"px":e.right=n.right+"px"):(t.top?(e.top=0,o=n.top):(e.bottom=0,o=-n.bottom),t.left?(e.left=0,i=n.left):(e.right=0,i=-n.right),e[_]="translateX("+Math.round(i)+"px) translateY("+Math.round(o)+"px)","msTransform"!==_?e[_]+=" translateZ(0)":void 0)},r=!1,(h.page.top||h.page.bottom)&&(h.page.left||h.page.right)?(e.position="absolute",c(h.page,t.page)):(h.viewport.top||h.viewport.bottom)&&(h.viewport.left||h.viewport.right)?(e.position="fixed",c(h.viewport,t.viewport)):null!=h.offset&&h.offset.top&&h.offset.left?(e.position="absolute",s=this.cache("target-offsetparent",function(){return f(S.target)}),f(this.element)!==s&&l(function(){return S.element.parentNode.removeChild(S.element),s.appendChild(S.element)}),c(h.offset,t.offset),r=!0):(e.position="absolute",c({top:!0,left:!0},t.page)),r||"BODY"===this.element.parentNode.tagName||(this.element.parentNode.removeChild(this.element),document.body.appendChild(this.element)),m={},g=!1;for(o in e)p=e[o],""===(n=this.element.style[o])||""===p||"top"!==o&&"left"!==o&&"bottom"!==o&&"right"!==o||(n=parseFloat(n),p=parseFloat(p)),n!==p&&(g=!0,m[o]=e[o]);return g?l(function(){return d(S.element.style,m)}):void 0}},t}(),i.position=C,this.Tether=d(T,i)}.call(this),function(){var t,e,n,i,o,r,s,a=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};(s=this.Tether.Utils).getOuterSize,o=s.getBounds,s.getSize,n=s.extend,r=s.updateClasses,e=s.defer,t=["left","top","right","bottom"],i=function(e,n){var i,r,s,a,l,d,h;if("scrollParent"===n?n=e.scrollParent:"window"===n&&(n=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset]),n===document&&(n=n.documentElement),null!=n.nodeType)for(r=a=o(n),l=getComputedStyle(n),n=[r.left,r.top,a.width+r.left,a.height+r.top],i=d=0,h=t.length;h>d;i=++d)s=t[i],s=s[0].toUpperCase()+s.substr(1),"Top"===s||"Left"===s?n[i]+=parseFloat(l["border"+s+"Width"]):n[i]-=parseFloat(l["border"+s+"Width"]);return n},this.Tether.modules.push({position:function(s){var l,d,h,c,f,u,p,g,m,v,b,C,y,S,_,x,N,T,k,E,O,w,L,B,A,P,$,D,U,I,R,F,M,W,z,H,q,j,Q,Y,Z,K,V,G,X,J,tt=this;if(A=s.top,b=s.left,E=s.targetAttachment,!this.options.constraints)return!0;for(function(e){var n,i,o,r;for(tt.removeClass(e),r=[],i=0,o=t.length;o>i;i++)n=t[i],r.push(tt.removeClass(e+"-"+n));return r},v=(Q=this.cache("element-bounds",function(){return o(tt.element)})).height,0===(P=Q.width)&&0===v&&null!=this.lastSize&&(Y=this.lastSize,P=Y.width,v=Y.height),O=(w=this.cache("target-bounds",function(){return tt.getTargetBounds()})).height,L=w.width,k={},m={},d=[this.getClass("pinned"),this.getClass("out-of-bounds")],$=0,R=(Z=this.options.constraints).length;R>$;$++)(g=Z[$]).outOfBoundsClass&&d.push(g.outOfBoundsClass),g.pinnedClass&&d.push(g.pinnedClass);for(D=0,F=d.length;F>D;D++)for(p=d[D],K=["left","top","right","bottom"],U=0,M=K.length;M>U;U++)T=K[U],d.push(p+"-"+T);for(l=[],k=n({},E),m=n({},this.attachment),I=0,W=(V=this.options.constraints).length;W>I;I++){if(g=V[I],B=g.to,h=g.attachment,_=g.pin,null==h&&(h=""),a.call(h," ")>=0?(G=h.split(" "),u=G[0],f=G[1]):f=u=h,c=i(this,B),("target"===u||"both"===u)&&(A<c[1]&&"top"===k.top&&(A+=O,k.top="bottom"),A+v>c[3]&&"bottom"===k.top&&(A-=O,k.top="top")),"together"===u&&(A<c[1]&&"top"===k.top&&("bottom"===m.top?(A+=O,k.top="bottom",A+=v,m.top="top"):"top"===m.top&&(A+=O,k.top="bottom",A-=v,m.top="bottom")),A+v>c[3]&&"bottom"===k.top&&("top"===m.top?(A-=O,k.top="top",A-=v,m.top="bottom"):"bottom"===m.top&&(A-=O,k.top="top",A+=v,m.top="top")),"middle"===k.top&&(A+v>c[3]&&"top"===m.top?(A-=v,m.top="bottom"):A<c[1]&&"bottom"===m.top&&(A+=v,m.top="top"))),("target"===f||"both"===f)&&(b<c[0]&&"left"===k.left&&(b+=L,k.left="right"),b+P>c[2]&&"right"===k.left&&(b-=L,k.left="left")),"together"===f&&(b<c[0]&&"left"===k.left?"right"===m.left?(b+=L,k.left="right",b+=P,m.left="left"):"left"===m.left&&(b+=L,k.left="right",b-=P,m.left="right"):b+P>c[2]&&"right"===k.left?"left"===m.left?(b-=L,k.left="left",b-=P,m.left="right"):"right"===m.left&&(b-=L,k.left="left",b+=P,m.left="left"):"center"===k.left&&(b+P>c[2]&&"left"===m.left?(b-=P,m.left="right"):b<c[0]&&"right"===m.left&&(b+=P,m.left="left"))),("element"===u||"both"===u)&&(A<c[1]&&"bottom"===m.top&&(A+=v,m.top="top"),A+v>c[3]&&"top"===m.top&&(A-=v,m.top="bottom")),("element"===f||"both"===f)&&(b<c[0]&&"right"===m.left&&(b+=P,m.left="left"),b+P>c[2]&&"left"===m.left&&(b-=P,m.left="right")),"string"==typeof _?_=function(){var t,e,n,i;for(i=[],e=0,t=(n=_.split(",")).length;t>e;e++)S=n[e],i.push(S.trim());return i}():!0===_&&(_=["top","left","right","bottom"]),_||(_=[]),x=[],C=[],A<c[1]&&(a.call(_,"top")>=0?(A=c[1],x.push("top")):C.push("top")),A+v>c[3]&&(a.call(_,"bottom")>=0?(A=c[3]-v,x.push("bottom")):C.push("bottom")),b<c[0]&&(a.call(_,"left")>=0?(b=c[0],x.push("left")):C.push("left")),b+P>c[2]&&(a.call(_,"right")>=0?(b=c[2]-P,x.push("right")):C.push("right")),x.length)for(N=null!=(X=this.options.pinnedClass)?X:this.getClass("pinned"),l.push(N),q=0,z=x.length;z>q;q++)T=x[q],l.push(N+"-"+T);if(C.length)for(y=null!=(J=this.options.outOfBoundsClass)?J:this.getClass("out-of-bounds"),l.push(y),j=0,H=C.length;H>j;j++)T=C[j],l.push(y+"-"+T);(a.call(x,"left")>=0||a.call(x,"right")>=0)&&(m.left=k.left=!1),(a.call(x,"top")>=0||a.call(x,"bottom")>=0)&&(m.top=k.top=!1),(k.top!==E.top||k.left!==E.left||m.top!==this.attachment.top||m.left!==this.attachment.left)&&this.updateAttachClasses(m,k)}return e(function(){return r(tt.target,l,d),r(tt.element,l,d)}),{top:A,left:b}}})}.call(this),function(){var t,e,n,i;i=this.Tether.Utils,e=i.getBounds,n=i.updateClasses,t=i.defer,this.Tether.modules.push({position:function(i){var o,r,s,a,l,d,h,c,f,u,p,g,m,v,b,C,y,S,_,x,N,T,k,E,O,w=this;if(p=i.top,d=i.left,N=this.cache("element-bounds",function(){return e(w.element)}),l=N.height,g=N.width,u=this.getTargetBounds(),a=p+l,h=d+g,o=[],p<=u.bottom&&a>=u.top)for(T=["left","right"],m=0,y=T.length;y>m;m++)c=T[m],((k=u[c])===d||k===h)&&o.push(c);if(d<=u.right&&h>=u.left)for(E=["top","bottom"],v=0,S=E.length;S>v;v++)c=E[v],((O=u[c])===p||O===a)&&o.push(c);for(r=[],f=["left","top","right","bottom"],(s=[]).push(this.getClass("abutted")),b=0,_=f.length;_>b;b++)c=f[b],s.push(this.getClass("abutted")+"-"+c);for(o.length&&r.push(this.getClass("abutted")),C=0,x=o.length;x>C;C++)c=o[C],r.push(this.getClass("abutted")+"-"+c);return t(function(){return n(w.target,r,s),n(w.element,r,s)}),!0}})}.call(this),function(){this.Tether.modules.push({position:function(t){var e,n,i,o,r,s,a;return s=t.top,e=t.left,this.options.shift?(n=function(t){return"function"==typeof t?t.call(this,{top:s,left:e}):t},i=n(this.options.shift),"string"==typeof i?((i=i.split(" "))[1]||(i[1]=i[0]),r=i[0],o=i[1],r=parseFloat(r,10),o=parseFloat(o,10)):(a=[i.top,i.left],r=a[0],o=a[1]),s+=r,e+=o,{top:s,left:e}):void 0}})}.call(this),this.Tether}),function(){var t,e,n,i,o,r,s,a,l,d,h,c,f,u,p,g,m,v={}.hasOwnProperty,b=function(t,e){function n(){this.constructor=t}for(var i in e)v.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},C=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};m=Tether.Utils,a=m.extend,n=m.addClass,h=m.removeClass,l=m.hasClass,t=m.Evented,u="ontouchstart"in document.documentElement,o=["click"],u&&o.push("touchstart"),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"},p="";for(d in g)s=g[d],void 0!==document.createElement("p").style[d]&&(p=s);f=function(t){var e,n,i,o;return i=t.split(" "),e=i[0],n=i[1],("left"===e||"right"===e)&&(o=[n,e],e=o[0],n=o[1]),[e,n].join(" ")},e={left:"right",right:"left",top:"bottom",bottom:"top",middle:"middle",center:"center"},i={},c=function(t,e){var n,i;for(i=[];-1!==(n=t.indexOf(e));)i.push(t.splice(n,1));return i},r=function(s){var d,u,g,m;return null==s&&(s={}),g=function(){return function(t,e,n){n.prototype=t.prototype;var i=new n,o=t.apply(i,e);return Object(o)===o?o:i}(d,arguments,function(){})},a(g,{createContext:r,drops:[],defaults:{}}),u={classPrefix:"drop",defaults:{position:"bottom left",openOn:"click",constrainToScrollParent:!0,constrainToWindow:!0,classes:"",remove:!1,tetherOptions:{}}},a(g,u,s),a(g.defaults,u.defaults,s.defaults),null==i[m=g.classPrefix]&&(i[m]=[]),g.updateBodyClasses=function(){var t,e,o,r;for(t=!1,e=0,o=(r=i[g.classPrefix]).length;o>e;e++)if(r[e].isOpened()){t=!0;break}return t?n(document.body,g.classPrefix+"-open"):h(document.body,g.classPrefix+"-open")},d=function(t){function r(t){if(this.options=t,this.options=a({},g.defaults,this.options),this.target=this.options.target,null==this.target)throw new Error("Drop Error: You must provide a target.");this.options.classes&&n(this.target,this.options.classes),g.drops.push(this),i[g.classPrefix].push(this),this._boundEvents=[],this.setupElements(),this.setupEvents(),this.setupTether()}return b(r,t),r.prototype._on=function(t,e,n){return this._boundEvents.push({element:t,event:e,handler:n}),t.addEventListener(e,n)},r.prototype.setupElements=function(){return this.drop=document.createElement("div"),n(this.drop,g.classPrefix),this.options.classes&&n(this.drop,this.options.classes),this.content=document.createElement("div"),n(this.content,g.classPrefix+"-content"),"object"==typeof this.options.content?this.content.appendChild(this.options.content):this.content.innerHTML=this.options.content,this.drop.appendChild(this.content)},r.prototype.setupTether=function(){var t,n;return n=this.options.position.split(" "),n[0]=e[n[0]],n=n.join(" "),(t=[]).push(this.options.constrainToScrollParent?{to:"scrollParent",pin:"top, bottom",attachment:"together none"}:{to:"scrollParent"}),t.push(!1!==this.options.constrainToWindow?{to:"window",attachment:"together"}:{to:"window"}),s={element:this.drop,target:this.target,attachment:f(n),targetAttachment:f(this.options.position),classPrefix:g.classPrefix,offset:"0 0",targetOffset:"0 0",enabled:!1,constraints:t},!1!==this.options.tetherOptions?this.tether=new Tether(a({},s,this.options.tetherOptions)):void 0},r.prototype.setupEvents=function(){var t,e,n,i,r,s,a,l,d,h,c=this;if(this.options.openOn){if("always"===this.options.openOn)return void setTimeout(this.open.bind(this));if(n=this.options.openOn.split(" "),C.call(n,"click")>=0)for(r=function(t){return c.toggle(),t.preventDefault()},e=function(t){return!c.isOpened()||t.target===c.drop||c.drop.contains(t.target)||t.target===c.target||c.target.contains(t.target)?void 0:c.close()},d=0,h=o.length;h>d;d++)t=o[d],this._on(this.target,t,r),this._on(document,t,e);return C.call(n,"hover")>=0?(i=!1,l=function(){return i=!0,c.open()},a=null,s=function(){return i=!1,null!=a&&clearTimeout(a),a=setTimeout(function(){return i||c.close(),a=null},50)},this._on(this.target,"mouseover",l),this._on(this.drop,"mouseover",l),this._on(this.target,"mouseout",s),this._on(this.drop,"mouseout",s)):void 0}},r.prototype.isOpened=function(){return l(this.drop,g.classPrefix+"-open")},r.prototype.toggle=function(){return this.isOpened()?this.close():this.open()},r.prototype.open=function(){var t,e,i=this;if(!this.isOpened())return this.drop.parentNode||document.body.appendChild(this.drop),null!=(t=this.tether)&&t.enable(),n(this.drop,g.classPrefix+"-open"),n(this.drop,g.classPrefix+"-open-transitionend"),setTimeout(function(){return n(i.drop,g.classPrefix+"-after-open")}),null!=(e=this.tether)&&e.position(),this.trigger("open"),g.updateBodyClasses()},r.prototype.close=function(){var t,e,n=this;if(this.isOpened())return h(this.drop,g.classPrefix+"-open"),h(this.drop,g.classPrefix+"-after-open"),this.drop.addEventListener(p,t=function(){return l(n.drop,g.classPrefix+"-open")||h(n.drop,g.classPrefix+"-open-transitionend"),n.drop.removeEventListener(p,t)}),this.trigger("close"),null!=(e=this.tether)&&e.disable(),g.updateBodyClasses(),this.options.remove?this.remove():void 0},r.prototype.remove=function(){var t;return this.close(),null!=(t=this.drop.parentNode)?t.removeChild(this.drop):void 0},r.prototype.position=function(){var t;return this.isOpened()&&null!=(t=this.tether)?t.position():void 0},r.prototype.destroy=function(){var t,e,n,o,r,s,a,l;for(this.remove(),null!=(s=this.tether)&&s.destroy(),o=0,r=(a=this._boundEvents).length;r>o;o++)l=a[o],t=l.element,e=l.event,n=l.handler,t.removeEventListener(e,n);return this._boundEvents=[],this.tether=null,this.drop=null,this.content=null,this.target=null,c(i[g.classPrefix],this),c(g.drops,this)},r}(t),g},window.Drop=r(),document.addEventListener("DOMContentLoaded",function(){return Drop.updateBodyClasses()})}.call(this);